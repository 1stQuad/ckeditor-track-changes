/*
#
# Opentip v2.4.6
#
# More info at [www.opentip.org](http://www.opentip.org)
# 
# Copyright (c) 2012, Matias Meno  
# Graphics by Tjandra Mayerhold
# 
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to deal
# in the Software without restriction, including without limitation the rights
# to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
# copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
# 
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
# 
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
# OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
# THE SOFTWARE.
#
*/
(function(b){var f,p,o,g,s,e,u,n,c,t,h,m=[].slice,d=[].indexOf||function(x){for(var w=0,v=this.length;w<v;w++){if(w in this&&this[w]===x){return w}}return -1},l={}.hasOwnProperty;f=(function(){i.prototype.STICKS_OUT_TOP=1;i.prototype.STICKS_OUT_BOTTOM=2;i.prototype.STICKS_OUT_LEFT=1;i.prototype.STICKS_OUT_RIGHT=2;i.prototype["class"]={container:"opentip-container",opentip:"opentip",header:"ot-header",content:"ot-content",loadingIndicator:"ot-loading-indicator",close:"ot-close",goingToHide:"ot-going-to-hide",hidden:"ot-hidden",hiding:"ot-hiding",goingToShow:"ot-going-to-show",showing:"ot-showing",visible:"ot-visible",loading:"ot-loading",ajaxError:"ot-ajax-error",fixed:"ot-fixed",showEffectPrefix:"ot-show-effect-",hideEffectPrefix:"ot-hide-effect-",stylePrefix:"style-"};function i(x,J,N,C){var L,H,G,v,B,D,y,w,K,M,F,A,z,E,I=this;this.id=++i.lastId;this.debug("Creating Opentip.");this._element=x;this._document=x.ownerDocument;this._window=this._document.defaultView;this._body=this._document.body;i.tips.push(this);this.adapter=i.adapter;L=this.adapter.data(x,"opentips")||[];L.push(this);this.adapter.data(x,"opentips",L);this.triggerElement=this.adapter.wrap(x);if(this.triggerElement.length>1){throw new Error("You can't call Opentip on multiple elements.")}if(this.triggerElement.length<1){throw new Error("Invalid element.")}this.loaded=false;this.loading=false;this.visible=false;this.waitingToShow=false;this.waitingToHide=false;this.currentPosition={left:0,top:0};this.dimensions={width:100,height:50};this.content="";this.redraw=true;this.currentObservers={showing:false,visible:false,hiding:false,hidden:false};C=this.adapter.clone(C);if(typeof J==="object"){C=J;J=N=void 0}else{if(typeof N==="object"){C=N;N=void 0}}if(N!=null){C.title=N}if(J!=null){this.setContent(J)}if(C["extends"]==null){if(C.style!=null){C["extends"]=C.style}else{C["extends"]=i.defaultStyle}}v=[C];E=C;while(E["extends"]){D=E["extends"];E=i.styles[D];if(E==null){throw new Error("Invalid style: "+D)}v.unshift(E);if(!((E["extends"]!=null)||D==="standard")){E["extends"]="standard"}}C=(F=this.adapter).extend.apply(F,[{}].concat(m.call(v)));C.hideTriggers=(function(){var R,Q,O,P;O=C.hideTriggers;P=[];for(R=0,Q=O.length;R<Q;R++){H=O[R];P.push(H)}return P})();if(C.hideTrigger&&C.hideTriggers.length===0){C.hideTriggers.push(C.hideTrigger)}A=["tipJoint","targetJoint","stem"];for(y=0,K=A.length;y<K;y++){B=A[y];if(C[B]&&typeof C[B]==="string"){C[B]=new i.Joint(C[B])}}if(C.ajax&&(C.ajax===true||!C.ajax)){if(this.adapter.tagName(this.triggerElement)==="A"){C.ajax=this.adapter.attr(this.triggerElement,"href")}else{C.ajax=false}}if(C.showOn==="click"&&this.adapter.tagName(this.triggerElement)==="A"){this.adapter.observe(this.triggerElement,"click",function(O){O.preventDefault();O.stopPropagation();return O.stopped=true})}if(C.target){C.fixed=true}if(C.stem===true){C.stem=new i.Joint(C.tipJoint)}if(C.target===true){C.target=this.triggerElement}else{if(C.target){C.target=this.adapter.wrap(C.target)}}this.currentStem=C.stem;if(C.delay==null){C.delay=C.showOn==="mouseover"?0.2:0}if(C.targetJoint==null){C.targetJoint=new i.Joint(C.tipJoint).flip()}this.showTriggers=[];this.showTriggersWhenVisible=[];this.hideTriggers=[];if(C.showOn&&C.showOn!=="creation"){this.showTriggers.push({element:this.triggerElement,event:C.showOn})}if(C.ajaxCache!=null){C.cache=C.ajaxCache;delete C.ajaxCache}this.options=C;this.bound={};z=["prepareToShow","prepareToHide","show","hide","reposition"];for(w=0,M=z.length;w<M;w++){G=z[w];this.bound[G]=(function(O){return function(){return I[O].apply(I,arguments)}})(G)}this.adapter.domReady(function(){I.activate();if(I.options.showOn==="creation"){return I.prepareToShow()}})}i.prototype._setup=function(){var A,E,F,C,z,y,D,v,B,x,w;this.debug("Setting up the tooltip.");this._buildContainer(this.triggerElement);this.hideTriggers=[];B=this.options.hideTriggers;for(C=z=0,D=B.length;z<D;C=++z){E=B[C];F=null;A=this.options.hideOn instanceof Array?this.options.hideOn[C]:this.options.hideOn;if(typeof E==="string"){switch(E){case"trigger":A=A||"mouseout";F=this.triggerElement;break;case"tip":A=A||"mouseover";F=this.container;break;case"target":A=A||"mouseover";F=this.options.target;break;case"closeButton":break;default:throw new Error("Unknown hide trigger: "+E+".")}}else{A=A||"mouseover";F=this.adapter.wrap(E)}if(F){this.hideTriggers.push({element:F,event:A,original:E})}}x=this.hideTriggers;w=[];for(y=0,v=x.length;y<v;y++){E=x[y];w.push(this.showTriggersWhenVisible.push({element:E.element,event:"mouseover"}))}return w};i.prototype._buildContainer=function(v){this.container=this.adapter.create('<div id="opentip-'+this.id+'" class="'+this["class"].container+" "+this["class"].hidden+" "+this["class"].stylePrefix+this.options.className+'"></div>',this._document);this.adapter.css(this.container,{position:"absolute"});if(this.options.ajax){this.adapter.addClass(this.container,this["class"].loading)}if(this.options.fixed){this.adapter.addClass(this.container,this["class"].fixed)}if(this.options.showEffect){this.adapter.addClass(this.container,""+this["class"].showEffectPrefix+this.options.showEffect)}if(this.options.hideEffect){return this.adapter.addClass(this.container,""+this["class"].hideEffectPrefix+this.options.hideEffect)}};i.prototype._buildElements=function(){var v,x,w=this._document;this.tooltipElement=this.adapter.create('<div class="'+this["class"].opentip+'"><div class="'+this["class"].header+'"></div><div class="'+this["class"].content+'"></div></div>',w);this.backgroundCanvas=this.adapter.wrap(w.createElement("canvas"));this.adapter.css(this.backgroundCanvas,{position:"absolute"});if(typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager!==null){G_vmlCanvasManager.initElement(this.adapter.unwrap(this.backgroundCanvas))}v=this.adapter.find(this.tooltipElement,"."+this["class"].header);if(this.options.title){x=this.adapter.create("<h1></h1>",w);this.adapter.update(x,this.options.title,this.options.escapeTitle);this.adapter.append(v,x)}if(this.options.ajax&&!this.loaded){this.adapter.append(this.tooltipElement,this.adapter.create('<div class="'+this["class"].loadingIndicator+'"><span>â†»</span></div>',w))}if(d.call(this.options.hideTriggers,"closeButton")>=0){this.closeButtonElement=this.adapter.create('<a href="javascript:undefined;" class="'+this["class"].close+'"><span>Close</span></a>',w);this.adapter.append(v,this.closeButtonElement)}this.adapter.append(this.container,this.backgroundCanvas);this.adapter.append(this.container,this.tooltipElement);this.adapter.append(this._body,this.container);this._newContent=true;return this.redraw=true};i.prototype.setContent=function(v){this.content=v;this._newContent=true;if(typeof this.content==="function"){this._contentFunction=this.content;this.content=""}else{this._contentFunction=null}if(this.visible){return this._updateElementContent()}};i.prototype._updateElementContent=function(){var v;if(this._newContent||(!this.options.cache&&this._contentFunction)){v=this.adapter.find(this.container,"."+this["class"].content);if(v!=null){if(this._contentFunction){this.debug("Executing content function.");this.content=this._contentFunction(this)}this.adapter.update(v,this.content,this.options.escapeContent)}this._newContent=false}this._storeAndLockDimensions();return this.reposition()};i.prototype._storeAndLockDimensions=function(){var v;if(!this.container){return}v=this.dimensions;this.adapter.css(this.container,{width:"auto",left:"0px",top:"0px"});this.dimensions=this.adapter.dimensions(this.container);this.dimensions.width+=1;this.adapter.css(this.container,{width:""+this.dimensions.width+"px",top:""+this.currentPosition.top+"px",left:""+this.currentPosition.left+"px"});if(!this._dimensionsEqual(this.dimensions,v)){this.redraw=true;return this._draw()}};i.prototype.activate=function(){return this._setupObservers("hidden","hiding")};i.prototype.deactivate=function(){this.debug("Deactivating tooltip.");this.hide();return this._setupObservers("-showing","-visible","-hidden","-hiding")};i.prototype._setupObservers=function(){var H,K,x,L,z,F,E,C,A,J,y,w,v,G,D,B,I=this;L=1<=arguments.length?m.call(arguments,0):[];for(F=0,J=L.length;F<J;F++){x=L[F];K=false;if(x.charAt(0)==="-"){K=true;x=x.substr(1)}if(this.currentObservers[x]===!K){continue}this.currentObservers[x]=!K;H=function(){var N,O,M;N=1<=arguments.length?m.call(arguments,0):[];if(K){return(O=I.adapter).stopObserving.apply(O,N)}else{return(M=I.adapter).observe.apply(M,N)}};switch(x){case"showing":G=this.hideTriggers;for(E=0,y=G.length;E<y;E++){z=G[E];H(z.element,z.event,this.bound.prepareToHide)}H((document.onresize!=null?document:window),"resize",this.bound.reposition);H(window,"scroll",this.bound.reposition);break;case"visible":D=this.showTriggersWhenVisible;for(C=0,w=D.length;C<w;C++){z=D[C];H(z.element,z.event,this.bound.prepareToShow)}break;case"hiding":B=this.showTriggers;for(A=0,v=B.length;A<v;A++){z=B[A];H(z.element,z.event,this.bound.prepareToShow)}break;case"hidden":break;default:throw new Error("Unknown state: "+x)}}return null};i.prototype.prepareToShow=function(){this._abortHiding();this._abortShowing();if(this.visible){return}this.debug("Showing in "+this.options.delay+"s.");if(this.container==null){this._setup()}if(this.options.group){i._abortShowingGroup(this.options.group,this)}this.preparingToShow=true;this._setupObservers("-hidden","-hiding","showing");this._followMousePosition();if(this.options.fixed&&!this.options.target){this.initialMousePosition=s}this.reposition();return this._showTimeoutId=this.setTimeout(this.bound.show,this.options.delay||0)};i.prototype.show=function(){var v=this;this._abortHiding();if(this.visible){return}this._clearTimeouts();if(!this._triggerElementExists()){return this.deactivate()}this.debug("Showing now.");if(this.container==null){this._setup()}if(this.options.group){i._hideGroup(this.options.group,this)}this.visible=true;this.preparingToShow=false;if(this.tooltipElement==null){this._buildElements()}this._updateElementContent();if(this.options.ajax&&(!this.loaded||!this.options.cache)){this._loadAjax()}this._searchAndActivateCloseButtons();this._startEnsureTriggerElement();this.adapter.css(this.container,{zIndex:i.lastZIndex++});this._setupObservers("-hidden","-hiding","-showing","-visible","showing","visible");if(this.options.fixed&&!this.options.target){this.initialMousePosition=s}this.reposition();this.adapter.removeClass(this.container,this["class"].hiding);this.adapter.removeClass(this.container,this["class"].hidden);this.adapter.addClass(this.container,this["class"].goingToShow);this.setCss3Style(this.container,{transitionDuration:"0s"});this.defer(function(){var w;if(!v.visible||v.preparingToHide){return}v.adapter.removeClass(v.container,v["class"].goingToShow);v.adapter.addClass(v.container,v["class"].showing);w=0;if(v.options.showEffect&&v.options.showEffectDuration){w=v.options.showEffectDuration}v.setCss3Style(v.container,{transitionDuration:""+w+"s"});v._visibilityStateTimeoutId=v.setTimeout(function(){v.adapter.removeClass(v.container,v["class"].showing);return v.adapter.addClass(v.container,v["class"].visible)},w);return v._activateFirstInput()});return this._draw()};i.prototype._abortShowing=function(){if(this.preparingToShow){this.debug("Aborting showing.");this._clearTimeouts();this._stopFollowingMousePosition();this.preparingToShow=false;return this._setupObservers("-showing","-visible","hiding","hidden")}};i.prototype.prepareToHide=function(){this._abortShowing();this._abortHiding();if(!this.visible){return}this.debug("Hiding in "+this.options.hideDelay+"s");this.preparingToHide=true;this._setupObservers("-showing","visible","-hidden","hiding");return this._hideTimeoutId=this.setTimeout(this.bound.hide,this.options.hideDelay)};i.prototype.hide=function(){var v=this;this._abortShowing();if(!this.visible){return}this._clearTimeouts();this.debug("Hiding!");this.visible=false;this.preparingToHide=false;this._stopEnsureTriggerElement();this._setupObservers("-showing","-visible","-hiding","-hidden","hiding","hidden");if(!this.options.fixed){this._stopFollowingMousePosition()}if(!this.container){return}this.adapter.removeClass(this.container,this["class"].visible);this.adapter.removeClass(this.container,this["class"].showing);this.adapter.addClass(this.container,this["class"].goingToHide);this.setCss3Style(this.container,{transitionDuration:"0s"});return this.defer(function(){var w;v.adapter.removeClass(v.container,v["class"].goingToHide);v.adapter.addClass(v.container,v["class"].hiding);w=0;if(v.options.hideEffect&&v.options.hideEffectDuration){w=v.options.hideEffectDuration}v.setCss3Style(v.container,{transitionDuration:""+w+"s"});return v._visibilityStateTimeoutId=v.setTimeout(function(){v.adapter.removeClass(v.container,v["class"].hiding);v.adapter.addClass(v.container,v["class"].hidden);v.setCss3Style(v.container,{transitionDuration:"0s"});if(v.options.removeElementsOnHide){v.debug("Removing HTML elements.");v.adapter.remove(v.container);delete v.container;return delete v.tooltipElement}},w)})};i.prototype._abortHiding=function(){if(this.preparingToHide){this.debug("Aborting hiding.");this._clearTimeouts();this.preparingToHide=false;return this._setupObservers("-hiding","showing","visible")}};i.prototype.reposition=function(){var v,x,w,y=this;v=this.getPosition();if(v==null){return}x=this.options.stem;if(this.options.containInViewport){w=this._ensureViewportContainment(v),v=w.position,x=w.stem}if(this._positionsEqual(v,this.currentPosition)){return}if(!(!this.options.stem||x.eql(this.currentStem))){this.redraw=true}this.currentPosition=v;this.currentStem=x;this._draw();this.adapter.css(this.container,{left:""+v.left+"px",top:""+v.top+"px"});return this.defer(function(){var A,z;A=y.adapter.unwrap(y.container);A.style.visibility="hidden";z=A.offsetHeight;return A.style.visibility="visible"})};i.prototype.getPosition=function(G,I,y){var v,x,H,B,F,w,z,E,A,C=this._body,D=this._window;if(!this.container){return}if(G==null){G=this.options.tipJoint}if(I==null){I=this.options.targetJoint}B={};if(this.options.target){z=this.adapter.offset(this.options.target);w=this.adapter.dimensions(this.options.target);B=z;if(I.right){E=this.adapter.unwrap(this.options.target);if(E.getBoundingClientRect!=null){B.left=E.getBoundingClientRect().right+((A=D.pageXOffset)!=null?A:C.scrollLeft)}else{B.left+=w.width}}else{if(I.center){B.left+=Math.round(w.width/2)}}if(I.bottom){B.top+=w.height}else{if(I.middle){B.top+=Math.round(w.height/2)}}if(this.options.borderWidth){if(this.options.tipJoint.left){B.left+=this.options.borderWidth}if(this.options.tipJoint.right){B.left-=this.options.borderWidth}if(this.options.tipJoint.top){B.top+=this.options.borderWidth}else{if(this.options.tipJoint.bottom){B.top-=this.options.borderWidth}}}}else{if(this.initialMousePosition){B={top:this.initialMousePosition.y,left:this.initialMousePosition.x}}else{B={top:s.y,left:s.x}}}if(this.options.autoOffset){F=this.options.stem?this.options.stemLength:0;H=F&&this.options.fixed?2:10;v=G.middle&&!this.options.fixed?15:0;x=G.center&&!this.options.fixed?15:0;if(G.right){B.left-=H+v}else{if(G.left){B.left+=H+v}}if(G.bottom){B.top-=H+x}else{if(G.top){B.top+=H+x}}if(F){if(y==null){y=this.options.stem}if(y.right){B.left-=F}else{if(y.left){B.left+=F}}if(y.bottom){B.top-=F}else{if(y.top){B.top+=F}}}}B.left+=this.options.offset[0];B.top+=this.options.offset[1];if(G.right){B.left-=this.dimensions.width}else{if(G.center){B.left-=Math.round(this.dimensions.width/2)}}if(G.bottom){B.top-=this.dimensions.height}else{if(G.middle){B.top-=Math.round(this.dimensions.height/2)}}return B};i.prototype._ensureViewportContainment=function(C){var H,z,D,y,x,B,w,A,I,F,E,v,G=this._document;w=this.options.stem;D={position:C,stem:w};if(!(this.visible&&C)){return D}A=this._sticksOut(C);if(!(A[0]||A[1])){return D}F=new i.Joint(this.options.tipJoint);if(this.options.targetJoint){I=new i.Joint(this.options.targetJoint)}B=this.adapter.scrollOffset(this._window,this._document);E=this.adapter.viewportDimensions(G);v=[C.left-B[0],C.top-B[1]];H=false;if(E.width>=this.dimensions.width){if(A[0]){H=true;switch(A[0]){case this.STICKS_OUT_LEFT:F.setHorizontal("left");if(this.options.targetJoint){I.setHorizontal("right")}break;case this.STICKS_OUT_RIGHT:F.setHorizontal("right");if(this.options.targetJoint){I.setHorizontal("left")}}}}if(E.height>=this.dimensions.height){if(A[1]){H=true;switch(A[1]){case this.STICKS_OUT_TOP:F.setVertical("top");if(this.options.targetJoint){I.setVertical("bottom")}break;case this.STICKS_OUT_BOTTOM:F.setVertical("bottom");if(this.options.targetJoint){I.setVertical("top")}}}}if(!H){return D}if(this.options.stem){w=F}C=this.getPosition(F,I,w);z=this._sticksOut(C);y=false;x=false;if(z[0]&&(z[0]!==A[0])){y=true;F.setHorizontal(this.options.tipJoint.horizontal);if(this.options.targetJoint){I.setHorizontal(this.options.targetJoint.horizontal)}}if(z[1]&&(z[1]!==A[1])){x=true;F.setVertical(this.options.tipJoint.vertical);if(this.options.targetJoint){I.setVertical(this.options.targetJoint.vertical)}}if(y&&x){return D}if(y||x){if(this.options.stem){w=F}C=this.getPosition(F,I,w)}return{position:C,stem:w}};i.prototype._sticksOut=function(w){var x,y,v,z;y=this.adapter.scrollOffset(this._window,this._document);z=this.adapter.viewportDimensions(this._document);x=[w.left-y[0],w.top-y[1]];v=[false,false];if(x[0]<0){v[0]=this.STICKS_OUT_LEFT}else{if(x[0]+this.dimensions.width>z.width){v[0]=this.STICKS_OUT_RIGHT}}if(x[1]<0){v[1]=this.STICKS_OUT_TOP}else{if(x[1]+this.dimensions.height>z.height){v[1]=this.STICKS_OUT_BOTTOM}}return v};i.prototype._draw=function(){var H,G,E,A,w,K,L,I,C,F,B,O,v,M,x,N,D,z,y,J=this;if(!(this.backgroundCanvas&&this.redraw)){return}this.debug("Drawing background.");this.redraw=false;if(this.currentStem){D=["top","right","bottom","left"];for(x=0,N=D.length;x<N;x++){O=D[x];this.adapter.removeClass(this.container,"stem-"+O)}this.adapter.addClass(this.container,"stem-"+this.currentStem.horizontal);this.adapter.addClass(this.container,"stem-"+this.currentStem.vertical)}K=[0,0];L=[0,0];if(d.call(this.options.hideTriggers,"closeButton")>=0){w=new i.Joint(((z=this.currentStem)!=null?z.toString():void 0)==="top right"?"top left":"top right");K=[this.options.closeButtonRadius+this.options.closeButtonOffset[0],this.options.closeButtonRadius+this.options.closeButtonOffset[1]];L=[this.options.closeButtonRadius-this.options.closeButtonOffset[0],this.options.closeButtonRadius-this.options.closeButtonOffset[1]]}E=this.adapter.clone(this.dimensions);A=[0,0];if(this.options.borderWidth){E.width+=this.options.borderWidth*2;E.height+=this.options.borderWidth*2;A[0]-=this.options.borderWidth;A[1]-=this.options.borderWidth}if(this.options.shadow){E.width+=this.options.shadowBlur*2;E.width+=Math.max(0,this.options.shadowOffset[0]-this.options.shadowBlur*2);E.height+=this.options.shadowBlur*2;E.height+=Math.max(0,this.options.shadowOffset[1]-this.options.shadowBlur*2);A[0]-=Math.max(0,this.options.shadowBlur-this.options.shadowOffset[0]);A[1]-=Math.max(0,this.options.shadowBlur-this.options.shadowOffset[1])}G={left:0,right:0,top:0,bottom:0};if(this.currentStem){if(this.currentStem.left){G.left=this.options.stemLength}else{if(this.currentStem.right){G.right=this.options.stemLength}}if(this.currentStem.top){G.top=this.options.stemLength}else{if(this.currentStem.bottom){G.bottom=this.options.stemLength}}}if(w){if(w.left){G.left=Math.max(G.left,L[0])}else{if(w.right){G.right=Math.max(G.right,L[0])}}if(w.top){G.top=Math.max(G.top,L[1])}else{if(w.bottom){G.bottom=Math.max(G.bottom,L[1])}}}E.width+=G.left+G.right;E.height+=G.top+G.bottom;A[0]-=G.left;A[1]-=G.top;if(this.currentStem&&this.options.borderWidth){y=this._getPathStemMeasures(this.options.stemBase,this.options.stemLength,this.options.borderWidth),M=y.stemLength,v=y.stemBase}H=this.adapter.unwrap(this.backgroundCanvas);H.width=E.width;H.height=E.height;this.adapter.css(this.backgroundCanvas,{width:""+H.width+"px",height:""+H.height+"px",left:""+A[0]+"px",top:""+A[1]+"px"});I=H.getContext("2d");I.setTransform(1,0,0,1,0,0);I.clearRect(0,0,H.width,H.height);I.beginPath();I.fillStyle=this._getColor(I,this.dimensions,this.options.background,this.options.backgroundGradientHorizontal);I.lineJoin="miter";I.miterLimit=500;B=this.options.borderWidth/2;if(this.options.borderWidth){I.strokeStyle=this.options.borderColor;I.lineWidth=this.options.borderWidth}else{M=this.options.stemLength;v=this.options.stemBase}if(v==null){v=0}F=function(P,R,Q){if(Q){I.moveTo(Math.max(v,J.options.borderRadius,K[0])+1-B,-B)}if(R){I.lineTo(P/2-v/2,-B);I.lineTo(P/2,-M-B);return I.lineTo(P/2+v/2,-B)}};C=function(V,Q,R){var U,S,P,T;if(V){I.lineTo(-v+B,0-B);I.lineTo(M+B,-M-B);return I.lineTo(B,v-B)}else{if(Q){T=J.options.closeButtonOffset;P=K[0];if(R%2!==0){T=[T[1],T[0]];P=K[1]}U=Math.acos(T[1]/J.options.closeButtonRadius);S=Math.acos(T[0]/J.options.closeButtonRadius);I.lineTo(-P+B,-B);return I.arc(B-T[0],-B+T[1],J.options.closeButtonRadius,-(Math.PI/2+U),S,false)}else{I.lineTo(-J.options.borderRadius+B,-B);return I.quadraticCurveTo(B,-B,B,J.options.borderRadius-B)}}};I.translate(-A[0],-A[1]);I.save();(function(){var V,U,P,Q,Y,X,W,Z,T,R,S;S=[];for(U=T=0,R=i.positions.length/2;0<=R?T<R:T>R;U=0<=R?++T:--T){Y=U*2;X=U===0||U===3?0:J.dimensions.width;W=U<2?0:J.dimensions.height;Z=(Math.PI/2)*U;P=U%2===0?J.dimensions.width:J.dimensions.height;Q=new i.Joint(i.positions[Y]);V=new i.Joint(i.positions[Y+1]);I.save();I.translate(X,W);I.rotate(Z);F(P,Q.eql(J.currentStem),U===0);I.translate(P,0);C(V.eql(J.currentStem),V.eql(w),U);S.push(I.restore())}return S})();I.closePath();I.save();if(this.options.shadow){I.shadowColor=this.options.shadowColor;I.shadowBlur=this.options.shadowBlur;I.shadowOffsetX=this.options.shadowOffset[0];I.shadowOffsetY=this.options.shadowOffset[1]}I.fill();I.restore();if(this.options.borderWidth){I.stroke()}I.restore();if(w){return(function(){var Q,P,T,S,R;T=P=J.options.closeButtonRadius*2;if(w.toString()==="top right"){R=[J.dimensions.width-J.options.closeButtonOffset[0],J.options.closeButtonOffset[1]];Q=[R[0]+B,R[1]-B]}else{R=[J.options.closeButtonOffset[0],J.options.closeButtonOffset[1]];Q=[R[0]-B,R[1]-B]}I.translate(Q[0],Q[1]);S=J.options.closeButtonCrossSize/2;I.save();I.beginPath();I.strokeStyle=J.options.closeButtonCrossColor;I.lineWidth=J.options.closeButtonCrossLineWidth;I.lineCap="round";I.moveTo(-S,-S);I.lineTo(S,S);I.stroke();I.beginPath();I.moveTo(S,-S);I.lineTo(-S,S);I.stroke();I.restore();return J.adapter.css(J.closeButtonElement,{left:""+(R[0]-S-J.options.closeButtonLinkOverscan)+"px",top:""+(R[1]-S-J.options.closeButtonLinkOverscan)+"px",width:""+(J.options.closeButtonCrossSize+J.options.closeButtonLinkOverscan*2)+"px",height:""+(J.options.closeButtonCrossSize+J.options.closeButtonLinkOverscan*2)+"px"})})()}};i.prototype._getPathStemMeasures=function(y,E,v){var z,w,C,B,A,x,D;B=v/2;C=Math.atan((y/2)/E);z=C*2;A=B/Math.sin(z);w=2*A*Math.cos(C);D=B+E-w;if(D<0){throw new Error("Sorry but your stemLength / stemBase ratio is strange.")}x=(Math.tan(C)*D)*2;return{stemLength:D,stemBase:x}};i.prototype._getColor=function(D,v,x,w){var A,C,z,y,B;if(w==null){w=false}if(typeof x==="string"){return x}if(w){C=D.createLinearGradient(0,0,v.width,0)}else{C=D.createLinearGradient(0,0,0,v.height)}for(z=y=0,B=x.length;y<B;z=++y){A=x[z];C.addColorStop(A[0],A[1])}return C};i.prototype._searchAndActivateCloseButtons=function(){var w,y,v,x;x=this.adapter.findAll(this.container,"."+this["class"].close);for(y=0,v=x.length;y<v;y++){w=x[y];this.hideTriggers.push({element:this.adapter.wrap(w),event:"click"})}if(this.currentObservers.showing){this._setupObservers("-showing","showing")}if(this.currentObservers.visible){return this._setupObservers("-visible","visible")}};i.prototype._activateFirstInput=function(){var v;v=this.adapter.unwrap(this.adapter.find(this.container,"input, textarea"));return v!=null?typeof v.focus==="function"?v.focus():void 0:void 0};i.prototype._followMousePosition=function(){if(!this.options.fixed){return i._observeMousePosition(this.bound.reposition)}};i.prototype._stopFollowingMousePosition=function(){if(!this.options.fixed){return i._stopObservingMousePosition(this.bound.reposition)}};i.prototype._clearShowTimeout=function(){return clearTimeout(this._showTimeoutId)};i.prototype._clearHideTimeout=function(){return clearTimeout(this._hideTimeoutId)};i.prototype._clearTimeouts=function(){clearTimeout(this._visibilityStateTimeoutId);this._clearShowTimeout();return this._clearHideTimeout()};i.prototype._triggerElementExists=function(){var v;v=this.adapter.unwrap(this.triggerElement);while(v.parentNode){if(v.parentNode.tagName==="BODY"){return true}v=v.parentNode}return false};i.prototype._loadAjax=function(){var v=this;if(this.loading){return}this.loaded=false;this.loading=true;this.adapter.addClass(this.container,this["class"].loading);this.setContent("");this.debug("Loading content from "+this.options.ajax);return this.adapter.ajax({url:this.options.ajax,method:this.options.ajaxMethod,onSuccess:function(w){v.debug("Loading successful.");v.adapter.removeClass(v.container,v["class"].loading);return v.setContent(w)},onError:function(w){var x;x=v.options.ajaxErrorMessage;v.debug(x,w);v.setContent(x);return v.adapter.addClass(v.container,v["class"].ajaxError)},onComplete:function(){v.adapter.removeClass(v.container,v["class"].loading);v.loading=false;v.loaded=true;v._searchAndActivateCloseButtons();v._activateFirstInput();return v.reposition()}})};i.prototype._ensureTriggerElement=function(){if(!this._triggerElementExists()){this.deactivate();return this._stopEnsureTriggerElement()}};i.prototype._ensureTriggerElementInterval=1000;i.prototype._startEnsureTriggerElement=function(){var v=this;return this._ensureTriggerElementTimeoutId=setInterval((function(){return v._ensureTriggerElement()}),this._ensureTriggerElementInterval)};i.prototype._stopEnsureTriggerElement=function(){return clearInterval(this._ensureTriggerElementTimeoutId)};return i})();n=["khtml","ms","o","moz","webkit"];f.prototype.setCss3Style=function(w,x){var A,y,z,v,i;w=this.adapter.unwrap(w);i=[];for(A in x){if(!l.call(x,A)){continue}y=x[A];if(w.style[A]!=null){i.push(w.style[A]=y)}else{i.push((function(){var D,B,C;C=[];for(D=0,B=n.length;D<B;D++){z=n[D];v=""+(this.ucfirst(z))+(this.ucfirst(A));if(w.style[v]!=null){C.push(w.style[v]=y)}else{C.push(void 0)}}return C}).call(this))}}return i};f.prototype.defer=function(i){return setTimeout(i,0)};f.prototype.setTimeout=function(i,v){return setTimeout(i,v?v*1000:0)};f.prototype.ucfirst=function(i){if(i==null){return""}return i.charAt(0).toUpperCase()+i.slice(1)};f.prototype.dasherize=function(i){return i.replace(/([A-Z])/g,function(v,w){return"-"+(w.toLowerCase())})};e=[];s={x:0,y:0};g=function(y){var w,x,v,i;s=f.adapter.mousePosition(y);i=[];for(x=0,v=e.length;x<v;x++){w=e[x];i.push(w())}return i};f._observeMousePosition=function(i){return e.push(i)};f._stopObservingMousePosition=function(i){var v;return e=(function(){var y,x,w;w=[];for(y=0,x=e.length;y<x;y++){v=e[y];if(v!==i){w.push(v)}}return w})()};f.Joint=(function(){function i(v){if(v==null){return}if(v instanceof f.Joint){v=v.toString()}this.set(v);this}i.prototype.set=function(v){v=v.toLowerCase();this.setHorizontal(v);this.setVertical(v);return this};i.prototype.setHorizontal=function(y){var z,B,C,A,x,w,v;B=["left","center","right"];for(C=0,x=B.length;C<x;C++){z=B[C];if(~y.indexOf(z)){this.horizontal=z.toLowerCase()}}if(this.horizontal==null){this.horizontal="center"}v=[];for(A=0,w=B.length;A<w;A++){z=B[A];v.push(this[z]=this.horizontal===z?z:void 0)}return v};i.prototype.setVertical=function(y){var z,B,C,A,x,w,v;B=["top","middle","bottom"];for(C=0,x=B.length;C<x;C++){z=B[C];if(~y.indexOf(z)){this.vertical=z.toLowerCase()}}if(this.vertical==null){this.vertical="middle"}v=[];for(A=0,w=B.length;A<w;A++){z=B[A];v.push(this[z]=this.vertical===z?z:void 0)}return v};i.prototype.eql=function(v){return(v!=null)&&this.horizontal===v.horizontal&&this.vertical===v.vertical};i.prototype.flip=function(){var v,w;w=f.position[this.toString(true)];v=(w+4)%8;this.set(f.positions[v]);return this};i.prototype.toString=function(x){var v,w;if(x==null){x=false}w=this.vertical==="middle"?"":this.vertical;v=this.horizontal==="center"?"":this.horizontal;if(w&&v){if(x){v=f.prototype.ucfirst(v)}else{v=" "+v}}return""+w+v};return i})();f.prototype._positionsEqual=function(i,v){return(i!=null)&&(v!=null)&&i.left===v.left&&i.top===v.top};f.prototype._dimensionsEqual=function(v,i){return(v!=null)&&(i!=null)&&v.width===i.width&&v.height===i.height};f.prototype.debug=function(){var i;i=1<=arguments.length?m.call(arguments,0):[];if(f.debug&&((typeof console!=="undefined"&&console!==null?console.debug:void 0)!=null)){i.unshift("#"+this.id+" |");return console.debug.apply(console,i)}};f.version="2.4.6";f.debug=false;f.lastId=0;f.lastZIndex=100;f.tips=[];f._abortShowingGroup=function(A,z){var w,y,v,x,i;x=f.tips;i=[];for(y=0,v=x.length;y<v;y++){w=x[y];if(w!==z&&w.options.group===A){i.push(w._abortShowing())}else{i.push(void 0)}}return i};f._hideGroup=function(A,z){var w,y,v,x,i;x=f.tips;i=[];for(y=0,v=x.length;y<v;y++){w=x[y];if(w!==z&&w.options.group===A){i.push(w.hide())}else{i.push(void 0)}}return i};f.adapters={};f.adapter=null;p=true;f.addAdapter=function(i){f.adapters[i.name]=i;if(p){f.adapter=i;return p=false}};f.positions=["top","topRight","right","bottomRight","bottom","bottomLeft","left","topLeft"];f.position={};h=f.positions;for(o=c=0,t=h.length;c<t;o=++c){u=h[o];f.position[u]=o}f.styles={standard:{"extends":null,title:void 0,escapeTitle:true,escapeContent:false,className:"standard",stem:true,delay:null,hideDelay:0.1,fixed:false,showOn:"mouseover",hideTrigger:"trigger",hideTriggers:[],hideOn:null,removeElementsOnHide:false,offset:[0,0],containInViewport:true,autoOffset:true,showEffect:"appear",hideEffect:"fade",showEffectDuration:0.3,hideEffectDuration:0.2,stemLength:5,stemBase:8,tipJoint:"top left",target:null,targetJoint:null,cache:true,ajax:false,ajaxMethod:"GET",ajaxErrorMessage:"There was a problem downloading the content.",group:null,style:null,background:"#fff18f",backgroundGradientHorizontal:false,closeButtonOffset:[5,5],closeButtonRadius:7,closeButtonCrossSize:4,closeButtonCrossColor:"#d2c35b",closeButtonCrossLineWidth:1.5,closeButtonLinkOverscan:6,borderRadius:5,borderWidth:1,borderColor:"#f2e37b",shadow:true,shadowBlur:10,shadowOffset:[3,3],shadowColor:"rgba(0, 0, 0, 0.1)"},glass:{"extends":"standard",className:"glass",background:[[0,"rgba(252, 252, 252, 0.8)"],[0.5,"rgba(255, 255, 255, 0.8)"],[0.5,"rgba(250, 250, 250, 0.9)"],[1,"rgba(245, 245, 245, 0.9)"]],borderColor:"#eee",closeButtonCrossColor:"rgba(0, 0, 0, 0.2)",borderRadius:15,closeButtonRadius:10,closeButtonOffset:[8,8]},dark:{"extends":"standard",className:"dark",borderRadius:13,borderColor:"#444",closeButtonCrossColor:"rgba(240, 240, 240, 1)",shadowColor:"rgba(0, 0, 0, 0.3)",shadowOffset:[2,2],background:[[0,"rgba(30, 30, 30, 0.7)"],[0.5,"rgba(30, 30, 30, 0.8)"],[0.5,"rgba(10, 10, 10, 0.8)"],[1,"rgba(10, 10, 10, 0.9)"]]},alert:{"extends":"standard",className:"alert",borderRadius:1,borderColor:"#AE0D11",closeButtonCrossColor:"rgba(255, 255, 255, 1)",shadowColor:"rgba(0, 0, 0, 0.3)",shadowOffset:[2,2],background:[[0,"rgba(203, 15, 19, 0.7)"],[0.5,"rgba(203, 15, 19, 0.8)"],[0.5,"rgba(189, 14, 18, 0.8)"],[1,"rgba(179, 14, 17, 0.9)"]]}};f.defaultStyle="standard";if(typeof module!=="undefined"&&module!==null){module.exports=f}else{window.Opentip=f}var m=[].slice;(function(i){var v;i.fn.opentip=function(x,y,w){return new f(this,x,y,w)};v=(function(){function w(){}w.prototype.name="jquery";w.prototype.domReady=function(x){return jQuery(x)};w.prototype.create=function(x,y){if(y){var z=y.createElement("div");z.innerHTML=x;z=z.firstChild;z.parentNode.removeChild(z);return jQuery(z)}else{return jQuery(x)}};w.prototype.wrap=function(x){x=i(x);if(x.length>1){throw new Error("Multiple elements provided.")}return x};w.prototype.unwrap=function(x){return i(x)[0]};w.prototype.tagName=function(x){return this.unwrap(x).tagName};w.prototype.attr=function(){var x,y,z;y=arguments[0],x=2<=arguments.length?m.call(arguments,1):[];return(z=i(y)).attr.apply(z,x)};w.prototype.data=function(){var x,y,z;y=arguments[0],x=2<=arguments.length?m.call(arguments,1):[];return(z=jQuery(y)).data.apply(z,x)};w.prototype.find=function(y,x){return jQuery(y).find(x).get(0)};w.prototype.findAll=function(y,x){return jQuery(y).find(x)};w.prototype.update=function(x,z,y){x=jQuery(x);if(y){return x.text(z)}else{return x.html(z)}};w.prototype.append=function(x,y){return i(x).append(y)};w.prototype.remove=function(x){return i(x).remove()};w.prototype.addClass=function(x,y){return i(x).addClass(y)};w.prototype.removeClass=function(x,y){return i(x).removeClass(y)};w.prototype.css=function(y,x){return i(y).css(x)};w.prototype.dimensions=function(x){return{width:i(x).outerWidth(),height:i(x).outerHeight()}};w.prototype.scrollOffset=function(y,x){return[y.pageXOffset||x.documentElement.scrollLeft||x.body.scrollLeft,y.pageYOffset||x.documentElement.scrollTop||x.body.scrollTop]};w.prototype.viewportDimensions=function(x){return{width:x.documentElement.clientWidth,height:x.documentElement.clientHeight}};w.prototype.mousePosition=function(x){if(x==null){return null}return{x:x.pageX,y:x.pageY}};w.prototype.offset=function(x){var y;y=jQuery(x).offset();return{left:y.left,top:y.top}};w.prototype.observe=function(z,y,x){return i(z).bind(y,x)};w.prototype.stopObserving=function(z,y,x){return i(z).unbind(y,x)};w.prototype.ajax=function(y){var z,x;if(y.url==null){throw new Error("No url provided")}return i.ajax({url:y.url,type:(z=(x=y.method)!=null?x.toUpperCase():void 0)!=null?z:"GET"}).done(function(A){return typeof y.onSuccess==="function"?y.onSuccess(A):void 0}).fail(function(A){return typeof y.onError==="function"?y.onError("Server responded with status "+A.status):void 0}).always(function(){return typeof y.onComplete==="function"?y.onComplete():void 0})};w.prototype.clone=function(x){return i.extend({},x)};w.prototype.extend=function(){var x,y;y=arguments[0],x=2<=arguments.length?m.call(arguments,1):[];return i.extend.apply(i,[y].concat(m.call(x)))};return w})();return f.addAdapter(new v)})(jQuery);var k={removeElementsOnHide:true,fixed:true,showOn:"creation"};var j={titleTemplate:"Changed by %u %t",delay:1000};function q(x,y,v,A){if(null===x||(typeof(x)=="undefined")){x=""}else{x=String(x)}v=String(v);var z=v.length;for(var w=x.length;w<y;w+=z){if(A){x+=padWidth}else{x=v+x}}return x}function r(i,v){return q(i,v,"0")}function a(w){var i=new Date();var A=i.getDate();var y=i.getMonth();var z=i.getFullYear();var C=typeof(w);if(C=="string"||C=="number"){w=new Date(w)}var v=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];if(A==w.getDate()&&y==w.getMonth()&&z==w.getFullYear()){var x=Math.floor((i.getTime()-w.getTime())/60000);if(x<1){return"now"}else{if(x<2){return"1 minute ago"}else{if(x<60){return(x+" minutes ago")}else{var B=w.getHours();var x=w.getMinutes();return"on "+r(B,2)+":"+r(x,2,"0")}}}}else{if(z==w.getFullYear()){return"on "+v[w.getMonth()]+" "+w.getDate()}else{return"on "+v[w.getMonth()]+" "+w.getDate()+", "+w.getFullYear()}}}b.OpentipAdapter=function(){};b.OpentipAdapter.prototype={makeTitle:function(w){var v=this._options.titleTemplate;var i=new Date(w.time);v=v.replace(/%t/g,a(i));v=v.replace(/%u/g,w.username);v=v.replace(/%dd/g,r(i.getDate(),2));v=v.replace(/%d/g,i.getDate());v=v.replace(/%mm/g,r(i.getMonth()+1,2));v=v.replace(/%m/g,i.getMonth()+1);v=v.replace(/%yy/g,r(i.getYear()-100,2));v=v.replace(/%y/g,i.getFullYear());v=v.replace(/%nn/g,r(i.getMinutes(),2));v=v.replace(/%n/g,i.getMinutes());v=v.replace(/%hh/g,r(i.getHours(),2));v=v.replace(/%h/g,i.getHours());return v},init:function(i){this._options=jQuery.extend(j,i||{})},getInterfaces:function(i){var v=this._options;i.tooltips=v.show;i.tooltipDelay=v.delay;i.showTooltip=(function(y,x){var A=this.makeTitle(x);if(A){var w=jQuery.extend({target:y},k),z=new f(y,A,w);z.show();jQuery(y).data("_lite_tip_",z)}}).bind(this);i.removeTooltip=function(x){var w=jQuery(x),y=w.data("_lite_tip_");if(y){y.hide();w.removeData("_lite_tip_")}}}}})(window);
/* Copyright (C) 2013 LoopIndex - All Rights Reserved
 * You may use, distribute and modify this code under the
 * terms of the LoopIndex Comments CKEditor plugin license.
 *
 * You should have received a copy of the LoopIndex Comments CKEditor plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */