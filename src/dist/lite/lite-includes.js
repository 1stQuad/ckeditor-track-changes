/* Source version: 1.2.27 */
(function(a){a.ice={}}(this||window));(function(b,a){if(typeof define=="function"&&define.amd){define(b)}else{if(typeof module!="undefined"&&typeof exports=="object"){module.exports=b()}else{a.rangy=b()}}})(function(){var u="object",d="function",A="undefined";var a=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var q=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var l=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var I=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"];function D(Q,P){var O=typeof Q[P];return O==d||(!!(O==u&&Q[P]))||O=="unknown"}function y(P,O){return !!(typeof P[O]==u&&P[O])}function f(P,O){return typeof P[O]!=A}function w(O){return function(R,Q){var P=Q.length;while(P--){if(!O(R,Q[P])){return false}}return true}}var j=w(D);var t=w(y);var g=w(f);function z(O){return O&&j(O,I)&&g(O,l)}function M(O){return y(O,"body")?O.body:O.getElementsByTagName("body")[0]}var b=[].forEach?function(O,P){O.forEach(P)}:function(P,R){for(var Q=0,O=P.length;Q<O;++Q){R(P[Q],Q)}};var v={};var C=(typeof window!=A&&typeof document!=A);var k={isHostMethod:D,isHostObject:y,isHostProperty:f,areHostMethods:j,areHostObjects:t,areHostProperties:g,isTextRange:z,getBody:M,forEach:b};var h={version:"1.3.0",initialized:false,isBrowser:C,supported:true,util:k,features:{},modules:v,config:{alertOnFail:false,alertOnWarn:false,preferTextRange:false,autoInitialize:(typeof rangyAutoInitialize==A)?true:rangyAutoInitialize}};function H(O){if(typeof console!=A&&D(console,"log")){console.log(O)}}function p(P,O){if(C&&O){alert(P)}else{H(P)}}function m(O){h.initialized=true;h.supported=false;p("Rangy is not supported in this environment. Reason: "+O,h.config.alertOnFail)}h.fail=m;function n(O){p("Rangy warning: "+O,h.config.alertOnWarn)}h.warn=n;var o;if({}.hasOwnProperty){k.extend=o=function(S,Q,O){var T,R;for(var P in Q){if(Q.hasOwnProperty(P)){T=S[P];R=Q[P];if(O&&T!==null&&typeof T=="object"&&R!==null&&typeof R=="object"){o(T,R,true)}S[P]=R}}if(Q.hasOwnProperty("toString")){S.toString=Q.toString}return S};k.createOptions=function(O,Q){var P={};o(P,Q);if(O){o(P,O)}return P}}else{m("hasOwnProperty not supported")}if(!C){m("Rangy can only run in a browser")}(function(){var O;if(C){var P=document.createElement("div");P.appendChild(document.createElement("span"));var R=[].slice;try{if(R.call(P.childNodes,0)[0].nodeType==1){O=function(S){return R.call(S,0)}}}catch(Q){}}if(!O){O=function(U){var T=[];for(var V=0,S=U.length;V<S;++V){T[V]=U[V]}return T}}k.toArray=O})();var i;if(C){if(D(document,"addEventListener")){i=function(Q,O,P){Q.addEventListener(O,P,false)}}else{if(D(document,"attachEvent")){i=function(Q,O,P){Q.attachEvent("on"+O,P)}}else{m("Document does not have required addEventListener or attachEvent method")}}k.addListener=i}var N=[];function c(O){return O.message||O.description||String(O)}function K(){if(!C||h.initialized){return}var Q;var X=false,R=false;if(D(document,"createRange")){Q=document.createRange();if(j(Q,q)&&g(Q,a)){X=true}}var T=M(document);if(!T||T.nodeName.toLowerCase()!="body"){m("No body element found");return}if(T&&D(T,"createTextRange")){Q=T.createTextRange();if(z(Q)){R=true}}if(!X&&!R){m("Neither Range nor TextRange are available");return}h.initialized=true;h.features={implementsDomRange:X,implementsTextRange:R};var P,V;for(var O in v){if((P=v[O]) instanceof x){P.init(P,h)}}for(var S=0,U=N.length;S<U;++S){try{N[S](h)}catch(W){V="Rangy init listener threw an exception. Continuing. Detail: "+c(W);H(V)}}}function F(O,Q,P){if(P){O+=" in module "+P.name}h.warn("DEPRECATED: "+O+" is deprecated. Please use "+Q+" instead.")}function J(O,P,R,Q){O[P]=function(){F(P,R,Q);return O[R].apply(O,k.toArray(arguments))}}k.deprecationNotice=F;k.createAliasForDeprecatedMethod=J;h.init=K;h.addInitListener=function(O){if(h.initialized){O(h)}else{N.push(O)}};var s=[];h.addShimListener=function(O){s.push(O)};function E(Q){Q=Q||window;K();for(var P=0,O=s.length;P<O;++P){s[P](Q)}}if(C){h.shim=h.createMissingNativeApi=E;J(h,"createMissingNativeApi","shim")}function x(O,Q,P){this.name=O;this.dependencies=Q;this.initialized=false;this.supported=false;this.initializer=P}x.prototype={init:function(){var R=this.dependencies||[];for(var Q=0,O=R.length,S,P;Q<O;++Q){P=R[Q];S=v[P];if(!S||!(S instanceof x)){throw new Error("required module '"+P+"' not found")}S.init();if(!S.supported){throw new Error("required module '"+P+"' not supported")}}this.initializer(this)},fail:function(O){this.initialized=true;this.supported=false;throw new Error(O)},warn:function(O){h.warn("Module "+this.name+": "+O)},deprecationNotice:function(O,P){h.warn("DEPRECATED: "+O+" in module "+this.name+" is deprecated. Please use "+P+" instead")},createError:function(O){return new Error("Error in Rangy "+this.name+" module: "+O)}};function r(O,Q,R){var P=new x(O,Q,function(U){if(!U.initialized){U.initialized=true;try{R(h,U);U.supported=true}catch(T){var S="Module '"+O+"' failed to load: "+c(T);H(S);if(T.stack){H(T.stack)}}}});v[O]=P;return P}h.createModule=function(O){var R,Q;if(arguments.length==2){R=arguments[1];Q=[]}else{R=arguments[2];Q=arguments[1]}var P=r(O,Q,R);if(h.initialized&&h.supported){P.init()}};h.createCoreModule=function(O,P,Q){r(O,P,Q)};function G(){}h.RangePrototype=G;h.rangePrototype=new G();function B(){}h.selectionPrototype=new B();h.createCoreModule("DomUtil",[],function(R,P){var ah="undefined";var T=R.util;var ax=T.getBody;if(!T.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){P.fail("document missing a Node creation method")}if(!T.isHostMethod(document,"getElementsByTagName")){P.fail("document missing getElementsByTagName method")}var av=document.createElement("div");if(!T.areHostMethods(av,["insertBefore","appendChild","cloneNode"]||!T.areHostObjects(av,["previousSibling","nextSibling","childNodes","parentNode"]))){P.fail("Incomplete Element implementation")}if(!T.isHostProperty(av,"innerHTML")){P.fail("Element is missing innerHTML property")}var ay=document.createTextNode("test");if(!T.areHostMethods(ay,["splitText","deleteData","insertData","appendData","cloneNode"]||!T.areHostObjects(av,["previousSibling","nextSibling","childNodes","parentNode"])||!T.areHostProperties(ay,["data"]))){P.fail("Incomplete Text Node implementation")}var aB=function(aC,aE){var aD=aC.length;while(aD--){if(aC[aD]===aE){return true}}return false};function V(aD){var aC;return typeof aD.namespaceURI==ah||((aC=aD.namespaceURI)===null||aC=="http://www.w3.org/1999/xhtml")}function ai(aD){var aC=aD.parentNode;return(aC.nodeType==1)?aC:null}function ac(aD){var aC=0;while((aD=aD.previousSibling)){++aC}return aC}function ak(aC){switch(aC.nodeType){case 7:case 10:return 0;case 3:case 8:return aC.length;default:return aC.childNodes.length}}function Z(aD,aC){var aE=[],aF;for(aF=aD;aF;aF=aF.parentNode){aE.push(aF)}for(aF=aC;aF;aF=aF.parentNode){if(aB(aE,aF)){return aF}}return null}function Y(aC,aD,aF){var aE=aF?aD:aD.parentNode;while(aE){if(aE===aC){return true}else{aE=aE.parentNode}}return false}function at(aC,aD){return Y(aC,aD,true)}function ap(aD,aC,aG){var aE,aF=aG?aD:aD.parentNode;while(aF){aE=aF.parentNode;if(aE===aC){return aF}aF=aE}return null}function Q(aD){var aC=aD.nodeType;return aC==3||aC==4||aC==8}function O(aD){if(!aD){return false}var aC=aD.nodeType;return aC==3||aC==8}function U(aF,aD){var aC=aD.nextSibling,aE=aD.parentNode;if(aC){aE.insertBefore(aF,aC)}else{aE.appendChild(aF)}return aF}function aj(aH,aE,aD){var aG=aH.cloneNode(false);aG.deleteData(0,aE);aH.deleteData(aE,aH.length-aE);U(aG,aH);if(aD){for(var aF=0,aC;aC=aD[aF++];){if(aC.node==aH&&aC.offset>aE){aC.node=aG;aC.offset-=aE}else{if(aC.node==aH.parentNode&&aC.offset>ac(aH)){++aC.offset}}}}return aG}function az(aC){if(aC.nodeType==9){return aC}else{if(typeof aC.ownerDocument!=ah){return aC.ownerDocument}else{if(typeof aC.document!=ah){return aC.document}else{if(aC.parentNode){return az(aC.parentNode)}else{throw P.createError("getDocument: no document found for node")}}}}}function ab(aC){var aD=az(aC);if(typeof aD.defaultView!=ah){return aD.defaultView}else{if(typeof aD.parentWindow!=ah){return aD.parentWindow}else{throw P.createError("Cannot get a window object for node")}}}function aA(aC){if(typeof aC.contentDocument!=ah){return aC.contentDocument}else{if(typeof aC.contentWindow!=ah){return aC.contentWindow.document}else{throw P.createError("getIframeDocument: No Document object found for iframe element")}}}function aw(aC){if(typeof aC.contentWindow!=ah){return aC.contentWindow}else{if(typeof aC.contentDocument!=ah){return aC.contentDocument.defaultView}else{throw P.createError("getIframeWindow: No Window object found for iframe element")}}}function an(aC){return aC&&T.isHostMethod(aC,"setTimeout")&&T.isHostObject(aC,"document")}function am(aF,aD,aC){var aE;if(!aF){aE=document}else{if(T.isHostProperty(aF,"nodeType")){aE=(aF.nodeType==1&&aF.tagName.toLowerCase()=="iframe")?aA(aF):az(aF)}else{if(an(aF)){aE=aF.document}}}if(!aE){throw aD.createError(aC+"(): Parameter must be a Window object or DOM node")}return aE}function W(aD){var aC;while((aC=aD.parentNode)){aD=aC}return aD}function aq(aF,aH,aE,aG){var aC,aI,aK,aJ,aD;if(aF==aE){return aH===aG?0:(aH<aG)?-1:1}else{if((aC=ap(aE,aF,true))){return aH<=ac(aC)?-1:1}else{if((aC=ap(aF,aE,true))){return ac(aC)<aG?-1:1}else{aI=Z(aF,aE);if(!aI){throw new Error("comparePoints error: nodes have no common ancestor")}aK=(aF===aI)?aI:ap(aF,aI,true);aJ=(aE===aI)?aI:ap(aE,aI,true);if(aK===aJ){throw P.createError("comparePoints got to case 4 and childA and childB are the same!")}else{aD=aI.firstChild;while(aD){if(aD===aK){return -1}else{if(aD===aJ){return 1}}aD=aD.nextSibling}}}}}}var af=false;function ae(aC){var aE;try{aE=aC.parentNode;return false}catch(aD){return true}}(function(){var aC=document.createElement("b");aC.innerHTML="1";var aD=aC.firstChild;aC.innerHTML="<br />";af=ae(aD);R.features.crashyTextNodes=af})();function ag(aC){if(!aC){return"[No node]"}if(af&&ae(aC)){return"[Broken node]"}if(Q(aC)){return'"'+aC.data+'"'}if(aC.nodeType==1){var aD=aC.id?' id="'+aC.id+'"':"";return"<"+aC.nodeName+aD+">[index:"+ac(aC)+",length:"+aC.childNodes.length+"]["+(aC.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return aC.nodeName}function ao(aD){var aC=az(aD).createDocumentFragment(),aE;while((aE=aD.firstChild)){aC.appendChild(aE)}return aC}var aa;if(typeof window.getComputedStyle!=ah){aa=function(aC,aD){return ab(aC).getComputedStyle(aC,null)[aD]}}else{if(typeof document.documentElement.currentStyle!=ah){aa=function(aC,aD){return aC.currentStyle?aC.currentStyle[aD]:""}}else{P.fail("No means of obtaining computed style properties found")}}function ar(aH,aE,aG){var aC=ax(aH);var aF=aH.createElement("div");aF.contentEditable=""+!!aG;if(aE){aF.innerHTML=aE}var aD=aC.firstChild;if(aD){aC.insertBefore(aF,aD)}else{aC.appendChild(aF)}return aF}function X(aC){return aC.parentNode.removeChild(aC)}function S(aC){this.root=aC;this._next=aC}S.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var aE=this._current=this._next;var aD,aC;if(this._current){aD=aE.firstChild;if(aD){this._next=aD}else{aC=null;while((aE!==this.root)&&!(aC=aE.nextSibling)){aE=aE.parentNode}this._next=aC}}return this._current},detach:function(){this._current=this._next=this.root=null}};function au(aC){return new S(aC)}function ad(aC,aD){this.node=aC;this.offset=aD}ad.prototype={equals:function(aC){return !!aC&&this.node===aC.node&&this.offset==aC.offset},inspect:function(){return"[DomPosition("+ag(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};function al(aC){this.code=this[aC];this.codeName=aC;this.message="DOMException: "+this.codeName}al.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};al.prototype.toString=function(){return this.message};R.dom={arrayContains:aB,isHtmlNamespace:V,parentElement:ai,getNodeIndex:ac,getNodeLength:ak,getCommonAncestor:Z,isAncestorOf:Y,isOrIsAncestorOf:at,getClosestAncestorIn:ap,isCharacterDataNode:Q,isTextOrCommentNode:O,insertAfter:U,splitDataNode:aj,getDocument:az,getWindow:ab,getIframeWindow:aw,getIframeDocument:aA,getBody:ax,isWindow:an,getContentDocument:am,getRootContainer:W,comparePoints:aq,isBrokenNode:ae,inspectNode:ag,getComputedStyleProperty:aa,createTestElement:ar,removeNode:X,fragmentFromNodeChildren:ao,createIterator:au,DomPosition:ad};R.DOMException=al});h.createCoreModule("DomRange",["DomUtil"],function(ad,a7){var ag=ad.dom;var aV=ad.util;var av=ag.DomPosition;var aM=ad.DOMException;var az=ag.isCharacterDataNode;var R=ag.getNodeIndex;var ay=ag.isOrIsAncestorOf;var a8=ag.getDocument;var aX=ag.comparePoints;var a3=ag.splitDataNode;var aP=ag.getClosestAncestorIn;var aC=ag.getNodeLength;var a5=ag.arrayContains;var ah=ag.getRootContainer;var ak=ad.features.crashyTextNodes;var a0=ag.removeNode;function aR(ba,a9){return(ba.nodeType!=3)&&(ay(ba,a9.startContainer)||ay(ba,a9.endContainer))}function aY(a9){return a9.document||a8(a9.startContainer)}function O(a9){return ah(a9.startContainer)}function al(a9){return new av(a9.parentNode,R(a9))}function W(a9){return new av(a9.parentNode,R(a9)+1)}function S(ba,bc,bb){var a9=ba.nodeType==11?ba.firstChild:ba;if(az(bc)){if(bb==bc.length){ag.insertAfter(ba,bc)}else{bc.parentNode.insertBefore(ba,bb==0?bc:a3(bc,bb))}}else{if(bb>=bc.childNodes.length){bc.appendChild(ba)}else{bc.insertBefore(ba,bc.childNodes[bb])}}return a9}function X(bc,bb,a9){P(bc);P(bb);if(aY(bb)!=aY(bc)){throw new aM("WRONG_DOCUMENT_ERR")}var bd=aX(bc.startContainer,bc.startOffset,bb.endContainer,bb.endOffset),ba=aX(bc.endContainer,bc.endOffset,bb.startContainer,bb.startOffset);return a9?bd<=0&&ba>=0:bd<0&&ba>0}function ae(bb){var ba;for(var bc,bd=aY(bb.range).createDocumentFragment(),a9;bc=bb.next();){ba=bb.isPartiallySelectedSubtree();bc=bc.cloneNode(!ba);if(ba){a9=bb.getSubtreeIterator();bc.appendChild(ae(a9));a9.detach()}if(bc.nodeType==10){throw new aM("HIERARCHY_REQUEST_ERR")}bd.appendChild(bc)}return bd}function aZ(ba,bd,a9){var bb,bf;a9=a9||{stop:false};for(var bc,be;bc=ba.next();){if(ba.isPartiallySelectedSubtree()){if(bd(bc)===false){a9.stop=true;return}else{be=ba.getSubtreeIterator();aZ(be,bd,a9);be.detach();if(a9.stop){return}}}else{bb=ag.createIterator(bc);while((bf=bb.next())){if(bd(bf)===false){a9.stop=true;return}}}}}function aA(ba){var a9;while(ba.next()){if(ba.isPartiallySelectedSubtree()){a9=ba.getSubtreeIterator();aA(a9);a9.detach()}else{ba.remove()}}}function aU(ba){for(var bb,bc=aY(ba.range).createDocumentFragment(),a9;bb=ba.next();){if(ba.isPartiallySelectedSubtree()){bb=bb.cloneNode(false);a9=ba.getSubtreeIterator();bb.appendChild(aU(a9));a9.detach()}else{ba.remove()}if(bb.nodeType==10){throw new aM("HIERARCHY_REQUEST_ERR")}bc.appendChild(bb)}return bc}function aD(bb,a9,bc){var be=!!(a9&&a9.length),bd;var bf=!!bc;if(be){bd=new RegExp("^("+a9.join("|")+")$")}var ba=[];aZ(new aj(bb,false),function(bh){if(be&&!bd.test(bh.nodeType)){return}if(bf&&!bc(bh)){return}var bi=bb.startContainer;if(bh==bi&&az(bi)&&bb.startOffset==bi.length){return}var bg=bb.endContainer;if(bh==bg&&az(bg)&&bb.endOffset==0){return}ba.push(bh)});return ba}function a2(a9){var ba=(typeof a9.getName=="undefined")?"Range":a9.getName();return"["+ba+"("+ag.inspectNode(a9.startContainer)+":"+a9.startOffset+", "+ag.inspectNode(a9.endContainer)+":"+a9.endOffset+")]"}function aj(bb,ba){this.range=bb;this.clonePartiallySelectedTextNodes=ba;if(!bb.collapsed){this.sc=bb.startContainer;this.so=bb.startOffset;this.ec=bb.endContainer;this.eo=bb.endOffset;var a9=bb.commonAncestorContainer;if(this.sc===this.ec&&az(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===a9&&!az(this.sc))?this.sc.childNodes[this.so]:aP(this.sc,a9,true);this._last=(this.ec===a9&&!az(this.ec))?this.ec.childNodes[this.eo-1]:aP(this.ec,a9,true)}}}aj.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var a9=this._current=this._next;if(a9){this._next=(a9!==this._last)?a9.nextSibling:null;if(az(a9)&&this.clonePartiallySelectedTextNodes){if(a9===this.ec){(a9=a9.cloneNode(true)).deleteData(this.eo,a9.length-this.eo)}if(this._current===this.sc){(a9=a9.cloneNode(true)).deleteData(0,this.so)}}}return a9},remove:function(){var ba=this._current,bb,a9;if(az(ba)&&(ba===this.sc||ba===this.ec)){bb=(ba===this.sc)?this.so:0;a9=(ba===this.ec)?this.eo:ba.length;if(bb!=a9){ba.deleteData(bb,a9-bb)}}else{if(ba.parentNode){a0(ba)}else{}}},isPartiallySelectedSubtree:function(){var a9=this._current;return aR(a9,this.range)},getSubtreeIterator:function(){var ba;if(this.isSingleCharacterDataNode){ba=this.range.cloneRange();ba.collapse(false)}else{ba=new ap(aY(this.range));var be=this._current;var bc=be,a9=0,bd=be,bb=aC(be);if(ay(be,this.sc)){bc=this.sc;a9=this.so}if(ay(be,this.ec)){bd=this.ec;bb=this.eo}aQ(ba,bc,a9,bd,bb)}return new aj(ba,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var aF=[1,3,4,5,7,8,10];var aW=[2,9,11];var Y=[5,6,10,12];var an=[1,3,4,5,7,8,10,11];var a6=[1,3,4,5,7,8];function ab(a9){return function(bb,bd){var ba,bc=bd?bb:bb.parentNode;while(bc){ba=bc.nodeType;if(a5(a9,ba)){return bc}bc=bc.parentNode}return null}}var a4=ab([9,11]);var au=ab(Y);var am=ab([6,10,12]);function ac(ba,a9){if(am(ba,a9)){throw new aM("INVALID_NODE_TYPE_ERR")}}function Q(a9,ba){if(!a5(ba,a9.nodeType)){throw new aM("INVALID_NODE_TYPE_ERR")}}function aG(a9,ba){if(ba<0||ba>(az(a9)?a9.length:a9.childNodes.length)){throw new aM("INDEX_SIZE_ERR")}}function aO(ba,a9){if(a4(ba,true)!==a4(a9,true)){throw new aM("WRONG_DOCUMENT_ERR")}}function aB(a9){if(au(a9,true)){throw new aM("NO_MODIFICATION_ALLOWED_ERR")}}function aI(ba,a9){if(!ba){throw new aM(a9)}}function V(a9,ba){return ba<=(az(a9)?a9.length:a9.childNodes.length)}function aq(a9){return(!!a9.startContainer&&!!a9.endContainer&&!(ak&&(ag.isBrokenNode(a9.startContainer)||ag.isBrokenNode(a9.endContainer)))&&ah(a9.startContainer)==ah(a9.endContainer)&&V(a9.startContainer,a9.startOffset)&&V(a9.endContainer,a9.endOffset))}function P(a9){if(!aq(a9)){throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+a9.inspect()+")")}}var aH=document.createElement("style");var ax=false;try{aH.innerHTML="<b>x</b>";ax=(aH.firstChild.nodeType==3)}catch(aw){}ad.features.htmlParsingConforms=ax;var ai=ax?function(bb){var ba=this.startContainer;var bc=a8(ba);if(!ba){throw new aM("INVALID_STATE_ERR")}var a9=null;if(ba.nodeType==1){a9=ba}else{if(az(ba)){a9=ag.parentElement(ba)}}if(a9===null||(a9.nodeName=="HTML"&&ag.isHtmlNamespace(a8(a9).documentElement)&&ag.isHtmlNamespace(a9))){a9=bc.createElement("body")}else{a9=a9.cloneNode(false)}a9.innerHTML=bb;return ag.fragmentFromNodeChildren(a9)}:function(ba){var bb=aY(this);var a9=bb.createElement("body");a9.innerHTML=ba;return ag.fragmentFromNodeChildren(a9)};function ao(bb,a9){P(bb);var bf=bb.startContainer,be=bb.startOffset,bc=bb.endContainer,ba=bb.endOffset;var bd=(bf===bc);if(az(bc)&&ba>0&&ba<bc.length){a3(bc,ba,a9)}if(az(bf)&&be>0&&be<bf.length){bf=a3(bf,be,a9);if(bd){ba-=be;bc=bf}else{if(bc==bf.parentNode&&ba>=R(bf)){ba++}}be=0}bb.setStartAndEnd(bf,be,bc,ba)}function T(ba){P(ba);var a9=ba.commonAncestorContainer.parentNode.cloneNode(false);a9.appendChild(ba.cloneContents());return a9.innerHTML}var aJ=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var aN=0,aS=1,aa=2,U=3;var aK=0,aL=1,aT=2,aE=3;aV.extend(ad.rangePrototype,{compareBoundaryPoints:function(be,bb){P(this);aO(this.startContainer,bb.startContainer);var bg,ba,bf,a9;var bd=(be==U||be==aN)?"start":"end";var bc=(be==aS||be==aN)?"start":"end";bg=this[bd+"Container"];ba=this[bd+"Offset"];bf=bb[bc+"Container"];a9=bb[bc+"Offset"];return aX(bg,ba,bf,a9)},insertNode:function(ba){P(this);Q(ba,an);aB(this.startContainer);if(ay(ba,this.startContainer)){throw new aM("HIERARCHY_REQUEST_ERR")}var a9=S(ba,this.startContainer,this.startOffset);this.setStartBefore(a9)},cloneContents:function(){P(this);var bb,ba;if(this.collapsed){return aY(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&az(this.startContainer)){bb=this.startContainer.cloneNode(true);bb.data=bb.data.slice(this.startOffset,this.endOffset);ba=aY(this).createDocumentFragment();ba.appendChild(bb);return ba}else{var a9=new aj(this,true);bb=ae(a9);a9.detach()}return bb}},canSurroundContents:function(){P(this);aB(this.startContainer);aB(this.endContainer);var a9=new aj(this,true);var ba=(a9._first&&(aR(a9._first,this))||(a9._last&&aR(a9._last,this)));a9.detach();return !ba},surroundContents:function(ba){Q(ba,a6);if(!this.canSurroundContents()){throw new aM("INVALID_STATE_ERR")}var a9=this.extractContents();if(ba.hasChildNodes()){while(ba.lastChild){ba.removeChild(ba.lastChild)}}S(ba,this.startContainer,this.startOffset);ba.appendChild(a9);this.selectNode(ba)},cloneRange:function(){P(this);var a9=new ap(aY(this));var ba=aJ.length,bb;while(ba--){bb=aJ[ba];a9[bb]=this[bb]}return a9},toString:function(){P(this);var bb=this.startContainer;if(bb===this.endContainer&&az(bb)){return(bb.nodeType==3||bb.nodeType==4)?bb.data.slice(this.startOffset,this.endOffset):""}else{var a9=[],ba=new aj(this,true);aZ(ba,function(bc){if(bc.nodeType==3||bc.nodeType==4){a9.push(bc.data)}});ba.detach();return a9.join("")}},compareNode:function(bb){P(this);var ba=bb.parentNode;var bd=R(bb);if(!ba){throw new aM("NOT_FOUND_ERR")}var bc=this.comparePoint(ba,bd),a9=this.comparePoint(ba,bd+1);if(bc<0){return(a9>0)?aT:aK}else{return(a9>0)?aL:aE}},comparePoint:function(a9,ba){P(this);aI(a9,"HIERARCHY_REQUEST_ERR");aO(a9,this.startContainer);if(aX(a9,ba,this.startContainer,this.startOffset)<0){return -1}else{if(aX(a9,ba,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:ai,toHtml:function(){return T(this)},intersectsNode:function(bc,a9){P(this);if(ah(bc)!=O(this)){return false}var bb=bc.parentNode,be=R(bc);if(!bb){return true}var bd=aX(bb,be,this.endContainer,this.endOffset),ba=aX(bb,be+1,this.startContainer,this.startOffset);return a9?bd<=0&&ba>=0:bd<0&&ba>0},isPointInRange:function(a9,ba){P(this);aI(a9,"HIERARCHY_REQUEST_ERR");aO(a9,this.startContainer);return(aX(a9,ba,this.startContainer,this.startOffset)>=0)&&(aX(a9,ba,this.endContainer,this.endOffset)<=0)},intersectsRange:function(a9){return X(this,a9,false)},intersectsOrTouchesRange:function(a9){return X(this,a9,true)},intersection:function(a9){if(this.intersectsRange(a9)){var bc=aX(this.startContainer,this.startOffset,a9.startContainer,a9.startOffset),ba=aX(this.endContainer,this.endOffset,a9.endContainer,a9.endOffset);var bb=this.cloneRange();if(bc==-1){bb.setStart(a9.startContainer,a9.startOffset)}if(ba==1){bb.setEnd(a9.endContainer,a9.endOffset)}return bb}return null},union:function(a9){if(this.intersectsOrTouchesRange(a9)){var ba=this.cloneRange();if(aX(a9.startContainer,a9.startOffset,this.startContainer,this.startOffset)==-1){ba.setStart(a9.startContainer,a9.startOffset)}if(aX(a9.endContainer,a9.endOffset,this.endContainer,this.endOffset)==1){ba.setEnd(a9.endContainer,a9.endOffset)}return ba}else{throw new aM("Ranges do not intersect")}},containsNode:function(ba,a9){if(a9){return this.intersectsNode(ba,false)}else{return this.compareNode(ba)==aE}},containsNodeContents:function(a9){return this.comparePoint(a9,0)>=0&&this.comparePoint(a9,aC(a9))<=0},containsRange:function(a9){var ba=this.intersection(a9);return ba!==null&&a9.equals(ba)},containsNodeText:function(bb){var bc=this.cloneRange();bc.selectNode(bb);var ba=bc.getNodes([3]);if(ba.length>0){bc.setStart(ba[0],0);var a9=ba.pop();bc.setEnd(a9,a9.length);return this.containsRange(bc)}else{return this.containsNodeContents(bb)}},getNodes:function(a9,ba){P(this);return aD(this,a9,ba)},getDocument:function(){return aY(this)},collapseBefore:function(a9){this.setEndBefore(a9);this.collapse(false)},collapseAfter:function(a9){this.setStartAfter(a9);this.collapse(true)},getBookmark:function(a9){var bd=aY(this);var bb=ad.createRange(bd);a9=a9||ag.getBody(bd);bb.selectNodeContents(a9);var bc=this.intersection(bb);var be=0,ba=0;if(bc){bb.setEnd(bc.startContainer,bc.startOffset);be=bb.toString().length;ba=be+bc.toString().length}return{start:be,end:ba,containerNode:a9}},moveToBookmark:function(bg){var bc=bg.containerNode;var a9=0;this.setStart(bc,0);this.collapse(true);var be=[bc],ba,bb=false,bh=false;var bf,bd,bi;while(!bh&&(ba=be.pop())){if(ba.nodeType==3){bf=a9+ba.length;if(!bb&&bg.start>=a9&&bg.start<=bf){this.setStart(ba,bg.start-a9);bb=true}if(bb&&bg.end>=a9&&bg.end<=bf){this.setEnd(ba,bg.end-a9);bh=true}a9=bf}else{bi=ba.childNodes;bd=bi.length;while(bd--){be.push(bi[bd])}}}},getName:function(){return"DomRange"},equals:function(a9){return ap.rangesEqual(this,a9)},isValid:function(){return aq(this)},inspect:function(){return a2(this)},detach:function(){}});function ar(a9){a9.START_TO_START=aN;a9.START_TO_END=aS;a9.END_TO_END=aa;a9.END_TO_START=U;a9.NODE_BEFORE=aK;a9.NODE_AFTER=aL;a9.NODE_BEFORE_AND_AFTER=aT;a9.NODE_INSIDE=aE}function af(a9){ar(a9);ar(a9.prototype)}function a1(a9,ba){return function(){P(this);var bg=this.startContainer,bf=this.startOffset,bb=this.commonAncestorContainer;var bd=new aj(this,true);var be,bh;if(bg!==bb){be=aP(bg,bb,true);bh=W(be);bg=bh.node;bf=bh.offset}aZ(bd,aB);bd.reset();var bc=a9(bd);bd.detach();ba(this,bg,bf,bg,bf);return bc}}function Z(ba,be){function bd(bg,bf){return function(bh){Q(bh,aF);Q(ah(bh),aW);var bi=(bg?al:W)(bh);(bf?a9:bc)(this,bi.node,bi.offset)}}function a9(bg,bi,bj){var bh=bg.endContainer,bf=bg.endOffset;if(bi!==bg.startContainer||bj!==bg.startOffset){if(ah(bi)!=ah(bh)||aX(bi,bj,bh,bf)==1){bh=bi;bf=bj}be(bg,bi,bj,bh,bf)}}function bc(bf,bg,bj){var bi=bf.startContainer,bh=bf.startOffset;if(bg!==bf.endContainer||bj!==bf.endOffset){if(ah(bg)!=ah(bi)||aX(bg,bj,bi,bh)==-1){bi=bg;bh=bj}be(bf,bi,bh,bg,bj)}}var bb=function(){};bb.prototype=ad.rangePrototype;ba.prototype=new bb();aV.extend(ba.prototype,{setStart:function(bf,bg){ac(bf,true);aG(bf,bg);a9(this,bf,bg)},setEnd:function(bf,bg){ac(bf,true);aG(bf,bg);bc(this,bf,bg)},setStartAndEnd:function(){var bh=arguments;var bj=bh[0],bi=bh[1],bg=bj,bf=bi;switch(bh.length){case 3:bf=bh[2];break;case 4:bg=bh[2];bf=bh[3];break}be(this,bj,bi,bg,bf)},setBoundary:function(bg,bh,bf){this["set"+(bf?"Start":"End")](bg,bh)},setStartBefore:bd(true,true),setStartAfter:bd(false,true),setEndBefore:bd(true,false),setEndAfter:bd(false,false),collapse:function(bf){P(this);if(bf){be(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{be(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(bf){ac(bf,true);be(this,bf,0,bf,aC(bf))},selectNode:function(bg){ac(bg,false);Q(bg,aF);var bh=al(bg),bf=W(bg);be(this,bh.node,bh.offset,bf.node,bf.offset)},extractContents:a1(aU,be),deleteContents:a1(aA,be),canSurroundContents:function(){P(this);aB(this.startContainer);aB(this.endContainer);var bf=new aj(this,true);var bg=(bf._first&&aR(bf._first,this)||(bf._last&&aR(bf._last,this)));bf.detach();return !bg},splitBoundaries:function(){ao(this)},splitBoundariesPreservingPositions:function(bf){ao(this,bf)},normalizeBoundaries:function(){P(this);var bm=this.startContainer,bh=this.startOffset,bl=this.endContainer,bf=this.endOffset;var bj=function(bq){var bp=bq.nextSibling;if(bp&&bp.nodeType==bq.nodeType){bl=bq;bf=bq.length;bq.appendData(bp.data);a0(bp)}};var bn=function(br){var bq=br.previousSibling;if(bq&&bq.nodeType==br.nodeType){bm=br;var bp=br.length;bh=bq.length;br.insertData(0,bq.data);a0(bq);if(bm==bl){bf+=bh;bl=bm}else{if(bl==br.parentNode){var bs=R(br);if(bf==bs){bl=br;bf=bp}else{if(bf>bs){bf--}}}}}};var bk=true;var bo;if(az(bl)){if(bf==bl.length){bj(bl)}else{if(bf==0){bo=bl.previousSibling;if(bo&&bo.nodeType==bl.nodeType){bf=bo.length;if(bm==bl){bk=false}bo.appendData(bl.data);a0(bl);bl=bo}}}}else{if(bf>0){var bi=bl.childNodes[bf-1];if(bi&&az(bi)){bj(bi)}}bk=!this.collapsed}if(bk){if(az(bm)){if(bh==0){bn(bm)}else{if(bh==bm.length){bo=bm.nextSibling;if(bo&&bo.nodeType==bm.nodeType){if(bl==bo){bl=bm;bf+=bm.length}bm.appendData(bo.data);a0(bo)}}}}else{if(bh<bm.childNodes.length){var bg=bm.childNodes[bh];if(bg&&az(bg)){bn(bg)}}}}else{bm=bl;bh=bf}be(this,bm,bh,bl,bf)},collapseToPoint:function(bf,bg){ac(bf,true);aG(bf,bg);this.setStartAndEnd(bf,bg)}});af(ba)}function at(a9){a9.collapsed=(a9.startContainer===a9.endContainer&&a9.startOffset===a9.endOffset);a9.commonAncestorContainer=a9.collapsed?a9.startContainer:ag.getCommonAncestor(a9.startContainer,a9.endContainer)}function aQ(ba,bc,a9,bd,bb){ba.startContainer=bc;ba.startOffset=a9;ba.endContainer=bd;ba.endOffset=bb;ba.document=ag.getDocument(bc);at(ba)}function ap(a9){this.startContainer=a9;this.startOffset=0;this.endContainer=a9;this.endOffset=0;this.document=a9;at(this)}Z(ap,aQ);aV.extend(ap,{rangeProperties:aJ,RangeIterator:aj,copyComparisonConstants:af,createPrototypeRange:Z,inspect:a2,toHtml:T,getRangeDocument:aY,rangesEqual:function(ba,a9){return ba.startContainer===a9.startContainer&&ba.startOffset===a9.startOffset&&ba.endContainer===a9.endContainer&&ba.endOffset===a9.endOffset}});ad.DomRange=ap});h.createCoreModule("WrappedRange",["DomRange"],function(aa,S){var O,P;var W=aa.dom;var X=aa.util;var R=W.DomPosition;var ac=aa.DomRange;var Y=W.getBody;var ae=W.getContentDocument;var Z=W.isCharacterDataNode;if(aa.features.implementsDomRange){(function(){var ai;var ap=ac.rangeProperties;function af(ar){var at=ap.length,au;while(at--){au=ap[at];ar[au]=ar.nativeRange[au]}ar.collapsed=(ar.startContainer===ar.endContainer&&ar.startOffset===ar.endOffset)}function ak(au,ax,at,ay,av){var ar=(au.startContainer!==ax||au.startOffset!=at);var az=(au.endContainer!==ay||au.endOffset!=av);var aw=!au.equals(au.nativeRange);if(ar||az||aw){au.setEnd(ay,av);au.setStart(ax,at)}}var ah;O=function(ar){if(!ar){throw S.createError("WrappedRange: Range must be specified")}this.nativeRange=ar;af(this)};ac.createPrototypeRange(O,ak);ai=O.prototype;ai.selectNode=function(ar){this.nativeRange.selectNode(ar);af(this)};ai.cloneContents=function(){return this.nativeRange.cloneContents()};ai.surroundContents=function(ar){this.nativeRange.surroundContents(ar);af(this)};ai.collapse=function(ar){this.nativeRange.collapse(ar);af(this)};ai.cloneRange=function(){return new O(this.nativeRange.cloneRange())};ai.refresh=function(){af(this)};ai.toString=function(){return this.nativeRange.toString()};var ao=document.createTextNode("test");Y(document).appendChild(ao);var al=document.createRange();al.setStart(ao,0);al.setEnd(ao,0);try{al.setStart(ao,1);ai.setStart=function(ar,at){this.nativeRange.setStart(ar,at);af(this)};ai.setEnd=function(ar,at){this.nativeRange.setEnd(ar,at);af(this)};ah=function(ar){return function(at){this.nativeRange[ar](at);af(this)}}}catch(an){ai.setStart=function(at,au){try{this.nativeRange.setStart(at,au)}catch(ar){this.nativeRange.setEnd(at,au);this.nativeRange.setStart(at,au)}af(this)};ai.setEnd=function(at,au){try{this.nativeRange.setEnd(at,au)}catch(ar){this.nativeRange.setStart(at,au);this.nativeRange.setEnd(at,au)}af(this)};ah=function(ar,at){return function(av){try{this.nativeRange[ar](av)}catch(au){this.nativeRange[at](av);this.nativeRange[ar](av)}af(this)}}}ai.setStartBefore=ah("setStartBefore","setEndBefore");ai.setStartAfter=ah("setStartAfter","setEndAfter");ai.setEndBefore=ah("setEndBefore","setStartBefore");ai.setEndAfter=ah("setEndAfter","setStartAfter");ai.selectNodeContents=function(ar){this.setStartAndEnd(ar,0,W.getNodeLength(ar))};al.selectNodeContents(ao);al.setEnd(ao,3);var aq=document.createRange();aq.selectNodeContents(ao);aq.setEnd(ao,4);aq.setStart(ao,2);if(al.compareBoundaryPoints(al.START_TO_END,aq)==-1&&al.compareBoundaryPoints(al.END_TO_START,aq)==1){ai.compareBoundaryPoints=function(at,ar){ar=ar.nativeRange||ar;if(at==ar.START_TO_END){at=ar.END_TO_START}else{if(at==ar.END_TO_START){at=ar.START_TO_END}}return this.nativeRange.compareBoundaryPoints(at,ar)}}else{ai.compareBoundaryPoints=function(at,ar){return this.nativeRange.compareBoundaryPoints(at,ar.nativeRange||ar)}}var ag=document.createElement("div");ag.innerHTML="123";var aj=ag.firstChild;var am=Y(document);am.appendChild(ag);al.setStart(aj,1);al.setEnd(aj,2);al.deleteContents();if(aj.data=="13"){ai.deleteContents=function(){this.nativeRange.deleteContents();af(this)};ai.extractContents=function(){var ar=this.nativeRange.extractContents();af(this);return ar}}else{}am.removeChild(ag);am=null;if(X.isHostMethod(al,"createContextualFragment")){ai.createContextualFragment=function(ar){return this.nativeRange.createContextualFragment(ar)}}Y(document).removeChild(ao);ai.getName=function(){return"WrappedRange"};aa.WrappedRange=O;aa.createNativeRange=function(ar){ar=ae(ar,S,"createNativeRange");return ar.createRange()}})()}if(aa.features.implementsTextRange){var T=function(ak){var ai=ak.parentElement();var ag=ak.duplicate();ag.collapse(true);var aj=ag.parentElement();ag=ak.duplicate();ag.collapse(false);var ah=ag.parentElement();var af=(aj==ah)?aj:W.getCommonAncestor(aj,ah);return af==ai?af:W.getCommonAncestor(ai,af)};var Q=function(af){return af.compareEndPoints("StartToEnd",af)==0};var U=function(af,ar,ap,ag,aj){var at=af.duplicate();at.collapse(ap);var ah=at.parentElement();if(!W.isOrIsAncestorOf(ar,ah)){ah=ar}if(!ah.canHaveHTML){var ao=new R(ah.parentNode,W.getNodeIndex(ah));return{boundaryPosition:ao,nodeInfo:{nodeIndex:ao.offset,containerElement:ao.node}}}var ai=W.getDocument(ah).createElement("span");if(ai.parentNode){W.removeNode(ai)}var aB,az=ap?"StartToStart":"StartToEnd";var au,ak,aq,av;var am=(aj&&aj.containerElement==ah)?aj.nodeIndex:0;var aw=ah.childNodes.length;var al=aw;var ay=al;while(true){if(ay==aw){ah.appendChild(ai)}else{ah.insertBefore(ai,ah.childNodes[ay])}at.moveToElementText(ai);aB=at.compareEndPoints(az,af);if(aB==0||am==al){break}else{if(aB==-1){if(al==am+1){break}else{am=ay}}else{al=(al==am+1)?am:ay}}ay=Math.floor((am+al)/2);ah.removeChild(ai)}av=ai.nextSibling;if(aB==-1&&av&&Z(av)){at.setEndPoint(ap?"EndToStart":"EndToEnd",af);var an;if(/[\r\n]/.test(av.data)){var ax=at.duplicate();var aA=ax.text.replace(/\r\n/g,"\r").length;an=ax.moveStart("character",aA);while((aB=ax.compareEndPoints("StartToEnd",ax))==-1){an++;ax.moveStart("character",1)}}else{an=at.text.length}aq=new R(av,an)}else{au=(ag||!ap)&&ai.previousSibling;ak=(ag||ap)&&ai.nextSibling;if(ak&&Z(ak)){aq=new R(ak,0)}else{if(au&&Z(au)){aq=new R(au,au.data.length)}else{aq=new R(ah,W.getNodeIndex(ai))}}}W.removeNode(ai);return{boundaryPosition:aq,nodeInfo:{nodeIndex:ay,containerElement:ah}}};var ad=function(af,ah){var ai,al,aj=af.offset;var am=W.getDocument(af.node);var ag,an,ao=Y(am).createTextRange();var ak=Z(af.node);if(ak){ai=af.node;al=ai.parentNode}else{an=af.node.childNodes;ai=(aj<an.length)?an[aj]:null;al=af.node}ag=am.createElement("span");ag.innerHTML="&#feff;";if(ai){al.insertBefore(ag,ai)}else{al.appendChild(ag)}ao.moveToElementText(ag);ao.collapse(!ah);al.removeChild(ag);if(ak){ao[ah?"moveStart":"moveEnd"]("character",aj)}return ao};P=function(af){this.textRange=af;this.refresh()};P.prototype=new ac(document);P.prototype.refresh=function(){var ai,af,ah;var ag=T(this.textRange);if(Q(this.textRange)){af=ai=U(this.textRange,ag,true,true).boundaryPosition}else{ah=U(this.textRange,ag,true,false);ai=ah.boundaryPosition;af=U(this.textRange,ag,false,false,ah.nodeInfo).boundaryPosition}this.setStart(ai.node,ai.offset);this.setEnd(af.node,af.offset)};P.prototype.getName=function(){return"WrappedTextRange"};ac.copyComparisonConstants(P);var ab=function(af){if(af.collapsed){return ad(new R(af.startContainer,af.startOffset),true)}else{var ai=ad(new R(af.startContainer,af.startOffset),true);var ah=ad(new R(af.endContainer,af.endOffset),false);var ag=Y(ac.getRangeDocument(af)).createTextRange();ag.setEndPoint("StartToStart",ai);ag.setEndPoint("EndToEnd",ah);return ag}};P.rangeToTextRange=ab;P.prototype.toTextRange=function(){return ab(this)};aa.WrappedTextRange=P;if(!aa.features.implementsDomRange||aa.config.preferTextRange){var V=(function(af){return af("return this;")()})(Function);if(typeof V.Range=="undefined"){V.Range=P}aa.createNativeRange=function(af){af=ae(af,S,"createNativeRange");return Y(af).createTextRange()};aa.WrappedRange=P}}aa.createRange=function(af){af=ae(af,S,"createRange");return new aa.WrappedRange(aa.createNativeRange(af))};aa.createRangyRange=function(af){af=ae(af,S,"createRangyRange");return new ac(af)};X.createAliasForDeprecatedMethod(aa,"createIframeRange","createRange");X.createAliasForDeprecatedMethod(aa,"createIframeRangyRange","createRangyRange");aa.addShimListener(function(ag){var af=ag.document;if(typeof af.createRange=="undefined"){af.createRange=function(){return aa.createRange(af)}}af=ag=null})});h.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(X,R){X.config.checkSelectionRanges=true;var ax="boolean";var aA="number";var Q=X.dom;var ac=X.util;var aL=ac.isHostMethod;var aP=X.DomRange;var T=X.WrappedRange;var aK=X.DOMException;var ar=Q.DomPosition;var aH;var ae;var ab=X.features;var aX="Control";var aW=Q.getDocument;var aV=Q.getBody;var aC=aP.rangesEqual;function U(aZ){return(typeof aZ=="string")?/^backward(s)?$/i.test(aZ):!!aZ}function an(a1,aZ){if(!a1){return window}else{if(Q.isWindow(a1)){return a1}else{if(a1 instanceof au){return a1.win}else{var a0=Q.getContentDocument(a1,R,aZ);return Q.getWindow(a0)}}}}function ad(aZ){return an(aZ,"getWinSelection").getSelection()}function ah(aZ){return an(aZ,"getDocSelection").document.selection}function aU(aZ){var a0=false;if(aZ.anchorNode){a0=(Q.comparePoints(aZ.anchorNode,aZ.anchorOffset,aZ.focusNode,aZ.focusOffset)==1)}return a0}var aS=aL(window,"getSelection"),aJ=ac.isHostObject(document,"selection");ab.implementsWinGetSelection=aS;ab.implementsDocSelection=aJ;var ak=aJ&&(!aS||X.config.preferTextRange);if(ak){aH=ah;X.isSelectionValid=function(a0){var a1=an(a0,"isSelectionValid").document,aZ=a1.selection;return(aZ.type!="None"||aW(aZ.createRange().parentElement())==a1)}}else{if(aS){aH=ad;X.isSelectionValid=function(){return true}}else{R.fail("Neither document.selection or window.getSelection() detected.");return false}}X.getNativeSelection=aH;var aI=aH();if(!aI){R.fail("Native selection was null (possibly issue 138?)");return false}var av=X.createNativeRange(document);var aw=aV(document);var aF=ac.areHostProperties(aI,["anchorNode","focusNode","anchorOffset","focusOffset"]);ab.selectionHasAnchorAndFocus=aF;var ag=aL(aI,"extend");ab.selectionHasExtend=ag;var aY=(typeof aI.rangeCount==aA);ab.selectionHasRangeCount=aY;var aO=false;var aM=true;var ao=ag?function(a2,aZ){var a1=aP.getRangeDocument(aZ);var a0=X.createRange(a1);a0.collapseToPoint(aZ.endContainer,aZ.endOffset);a2.addRange(aE(a0));a2.extend(aZ.startContainer,aZ.startOffset)}:null;if(ac.areHostMethods(aI,["addRange","getRangeAt","removeAllRanges"])&&typeof aI.rangeCount==aA&&ab.implementsDomRange){(function(){var a0=window.getSelection();if(a0){var a4=a0.rangeCount;var a6=(a4>1);var a7=[];var a9=aU(a0);for(var a5=0;a5<a4;++a5){a7[a5]=a0.getRangeAt(a5)}var a2=Q.createTestElement(document,"",false);var a3=a2.appendChild(document.createTextNode("\u00a0\u00a0\u00a0"));var a1=document.createRange();a1.setStart(a3,1);a1.collapse(true);a0.removeAllRanges();a0.addRange(a1);aM=(a0.rangeCount==1);a0.removeAllRanges();if(!a6){var a8=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(a8&&parseInt(a8[1])>=36){aO=false}else{var aZ=a1.cloneRange();a1.setStart(a3,0);aZ.setEnd(a3,3);aZ.setStart(a3,2);a0.addRange(a1);a0.addRange(aZ);aO=(a0.rangeCount==2)}}Q.removeNode(a2);a0.removeAllRanges();for(a5=0;a5<a4;++a5){if(a5==0&&a9){if(ao){ao(a0,a7[a5])}else{X.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend");a0.addRange(a7[a5])}}else{a0.addRange(a7[a5])}}}})()}ab.selectionSupportsMultipleRanges=aO;ab.collapsedNonEditableSelectionsSupported=aM;var W=false,Z;if(aw&&aL(aw,"createControlRange")){Z=aw.createControlRange();if(ac.areHostProperties(Z,["item","add"])){W=true}}ab.implementsControlRange=W;if(aF){ae=function(aZ){return aZ.anchorNode===aZ.focusNode&&aZ.anchorOffset===aZ.focusOffset}}else{ae=function(aZ){return aZ.rangeCount?aZ.getRangeAt(aZ.rangeCount-1).collapsed:false}}function P(a1,aZ,a2){var a0=a2?"end":"start",a3=a2?"start":"end";a1.anchorNode=aZ[a0+"Container"];a1.anchorOffset=aZ[a0+"Offset"];a1.focusNode=aZ[a3+"Container"];a1.focusOffset=aZ[a3+"Offset"]}function am(a0){var aZ=a0.nativeSelection;a0.anchorNode=aZ.anchorNode;a0.anchorOffset=aZ.anchorOffset;a0.focusNode=aZ.focusNode;a0.focusOffset=aZ.focusOffset}function aB(aZ){aZ.anchorNode=aZ.focusNode=null;aZ.anchorOffset=aZ.focusOffset=0;aZ.rangeCount=0;aZ.isCollapsed=true;aZ._ranges.length=0}function aE(aZ){var a0;if(aZ instanceof aP){a0=X.createNativeRange(aZ.getDocument());a0.setEnd(aZ.endContainer,aZ.endOffset);a0.setStart(aZ.startContainer,aZ.startOffset)}else{if(aZ instanceof T){a0=aZ.nativeRange}else{if(ab.implementsDomRange&&(aZ instanceof Q.getWindow(aZ.startContainer).Range)){a0=aZ}}}return a0}function aa(a1){if(!a1.length||a1[0].nodeType!=1){return false}for(var a0=1,aZ=a1.length;a0<aZ;++a0){if(!Q.isAncestorOf(a1[0],a1[a0])){return false}}return true}function aG(a0){var aZ=a0.getNodes();if(!aa(aZ)){throw R.createError("getSingleElementFromRange: range "+a0.inspect()+" did not consist of a single element")}return aZ[0]}function az(aZ){return !!aZ&&typeof aZ.text!="undefined"}function aD(a1,a0){var aZ=new T(a0);a1._ranges=[aZ];P(a1,aZ,false);a1.rangeCount=1;a1.isCollapsed=aZ.collapsed}function aj(a2){a2._ranges.length=0;if(a2.docSelection.type=="None"){aB(a2)}else{var a1=a2.docSelection.createRange();if(az(a1)){aD(a2,a1)}else{a2.rangeCount=a1.length;var aZ,a3=aW(a1.item(0));for(var a0=0;a0<a2.rangeCount;++a0){aZ=X.createRange(a3);aZ.selectNode(a1.item(a0));a2._ranges.push(aZ)}a2.isCollapsed=a2.rangeCount==1&&a2._ranges[0].collapsed;P(a2,a2._ranges[a2.rangeCount-1],false)}}}function aq(a0,a3){var a1=a0.docSelection.createRange();var aZ=aG(a3);var a7=aW(a1.item(0));var a4=aV(a7).createControlRange();for(var a2=0,a5=a1.length;a2<a5;++a2){a4.add(a1.item(a2))}try{a4.add(aZ)}catch(a6){throw R.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a4.select();aj(a0)}var af;if(aL(aI,"getRangeAt")){af=function(a1,aZ){try{return a1.getRangeAt(aZ)}catch(a0){return null}}}else{if(aF){af=function(a0){var a1=aW(a0.anchorNode);var aZ=X.createRange(a1);aZ.setStartAndEnd(a0.anchorNode,a0.anchorOffset,a0.focusNode,a0.focusOffset);if(aZ.collapsed!==this.isCollapsed){aZ.setStartAndEnd(a0.focusNode,a0.focusOffset,a0.anchorNode,a0.anchorOffset)}return aZ}}}function au(aZ,a1,a0){this.nativeSelection=aZ;this.docSelection=a1;this._ranges=[];this.win=a0;this.refresh()}au.prototype=X.selectionPrototype;function ap(aZ){aZ.win=aZ.anchorNode=aZ.focusNode=aZ._ranges=null;aZ.rangeCount=aZ.anchorOffset=aZ.focusOffset=0;aZ.detached=true}var aT=[];function aN(a3,a2){var aZ=aT.length,a0,a1;while(aZ--){a0=aT[aZ];a1=a0.selection;if(a2=="deleteAll"){ap(a1)}else{if(a0.win==a3){if(a2=="delete"){aT.splice(aZ,1);return true}else{return a1}}}}if(a2=="deleteAll"){aT.length=0}return null}var al=function(a1){if(a1&&a1 instanceof au){a1.refresh();return a1}a1=an(a1,"getNativeSelection");var a0=aN(a1);var aZ=aH(a1),a2=aJ?ah(a1):null;if(a0){a0.nativeSelection=aZ;a0.docSelection=a2;a0.refresh()}else{a0=new au(aZ,a2,a1);aT.push({win:a1,selection:a0})}return a0};X.getSelection=al;ac.createAliasForDeprecatedMethod(X,"getIframeSelection","getSelection");var O=au.prototype;function Y(a5,a0){var a6=aW(a0[0].startContainer);var a3=aV(a6).createControlRange();for(var a2=0,a4,aZ=a0.length;a2<aZ;++a2){a4=aG(a0[a2]);try{a3.add(a4)}catch(a1){throw R.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a3.select();aj(a5)}if(!ak&&aF&&ac.areHostMethods(aI,["removeAllRanges","addRange"])){O.removeAllRanges=function(){this.nativeSelection.removeAllRanges();aB(this)};var S=function(a0,aZ){ao(a0.nativeSelection,aZ);a0.refresh()};if(aY){O.addRange=function(a0,a4){if(W&&aJ&&this.docSelection.type==aX){aq(this,a0)}else{if(U(a4)&&ag){S(this,a0)}else{var a2;if(aO){a2=this.rangeCount}else{this.removeAllRanges();a2=0}var aZ=aE(a0).cloneRange();try{this.nativeSelection.addRange(aZ)}catch(a1){}this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==a2+1){if(X.config.checkSelectionRanges){var a3=af(this.nativeSelection,this.rangeCount-1);if(a3&&!aC(a3,a0)){a0=new T(a3)}}this._ranges[this.rangeCount-1]=a0;P(this,a0,V(this.nativeSelection));this.isCollapsed=ae(this)}else{this.refresh()}}}}}else{O.addRange=function(aZ,a0){if(U(a0)&&ag){S(this,aZ)}else{this.nativeSelection.addRange(aE(aZ));this.refresh()}}}O.setRanges=function(a0){if(W&&aJ&&a0.length>1){Y(this,a0)}else{this.removeAllRanges();for(var a1=0,aZ=a0.length;a1<aZ;++a1){this.addRange(a0[a1])}}}}else{if(aL(aI,"empty")&&aL(av,"select")&&W&&ak){O.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var a2;if(this.anchorNode){a2=aW(this.anchorNode)}else{if(this.docSelection.type==aX){var a0=this.docSelection.createRange();if(a0.length){a2=aW(a0.item(0))}}}if(a2){var a1=aV(a2).createTextRange();a1.select();this.docSelection.empty()}}}catch(aZ){}aB(this)};O.addRange=function(aZ){if(this.docSelection.type==aX){aq(this,aZ)}else{X.WrappedTextRange.rangeToTextRange(aZ).select();this._ranges[0]=aZ;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;P(this,aZ,false)}};O.setRanges=function(aZ){this.removeAllRanges();var a0=aZ.length;if(a0>1){Y(this,aZ)}else{if(a0){this.addRange(aZ[0])}}}}else{R.fail("No means of selecting a Range or TextRange was found");return false}}O.getRangeAt=function(aZ){if(aZ<0||aZ>=this.rangeCount){throw new aK("INDEX_SIZE_ERR")}else{return this._ranges[aZ].cloneRange()}};var ay;if(ak){ay=function(a0){var aZ;if(X.isSelectionValid(a0.win)){aZ=a0.docSelection.createRange()}else{aZ=aV(a0.win.document).createTextRange();aZ.collapse(true)}if(a0.docSelection.type==aX){aj(a0)}else{if(az(aZ)){aD(a0,aZ)}else{aB(a0)}}}}else{if(aL(aI,"getRangeAt")&&typeof aI.rangeCount==aA){ay=function(a1){if(W&&aJ&&a1.docSelection.type==aX){aj(a1)}else{a1._ranges.length=a1.rangeCount=a1.nativeSelection.rangeCount;if(a1.rangeCount){for(var a0=0,aZ=a1.rangeCount;a0<aZ;++a0){a1._ranges[a0]=new X.WrappedRange(a1.nativeSelection.getRangeAt(a0))}P(a1,a1._ranges[a1.rangeCount-1],V(a1.nativeSelection));a1.isCollapsed=ae(a1)}else{aB(a1)}}}}else{if(aF&&typeof aI.isCollapsed==ax&&typeof av.collapsed==ax&&ab.implementsDomRange){ay=function(a1){var aZ,a0=a1.nativeSelection;if(a0.anchorNode){aZ=af(a0,0);a1._ranges=[aZ];a1.rangeCount=1;am(a1);a1.isCollapsed=ae(a1)}else{aB(a1)}}}else{R.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}O.refresh=function(a0){var aZ=a0?this._ranges.slice(0):null;var a2=this.anchorNode,a3=this.anchorOffset;ay(this);if(a0){var a1=aZ.length;if(a1!=this._ranges.length){return true}if(this.anchorNode!=a2||this.anchorOffset!=a3){return true}while(a1--){if(!aC(aZ[a1],this._ranges[a1])){return true}}return false}};var at=function(a3,a1){var a0=a3.getAllRanges();a3.removeAllRanges();for(var a2=0,aZ=a0.length;a2<aZ;++a2){if(!aC(a1,a0[a2])){a3.addRange(a0[a2])}}if(!a3.rangeCount){aB(a3)}};if(W&&aJ){O.removeRange=function(a3){if(this.docSelection.type==aX){var a1=this.docSelection.createRange();var aZ=aG(a3);var a7=aW(a1.item(0));var a5=aV(a7).createControlRange();var a0,a6=false;for(var a2=0,a4=a1.length;a2<a4;++a2){a0=a1.item(a2);if(a0!==aZ||a6){a5.add(a1.item(a2))}else{a6=true}}a5.select();aj(this)}else{at(this,a3)}}}else{O.removeRange=function(aZ){at(this,aZ)}}var V;if(!ak&&aF&&ab.implementsDomRange){V=aU;O.isBackward=function(){return V(this)}}else{V=O.isBackward=function(){return false}}O.isBackwards=O.isBackward;O.toString=function(){var a1=[];for(var a0=0,aZ=this.rangeCount;a0<aZ;++a0){a1[a0]=""+this._ranges[a0]}return a1.join("")};function aQ(a0,aZ){if(a0.win.document!=aW(aZ)){throw new aK("WRONG_DOCUMENT_ERR")}}O.collapse=function(a0,a1){aQ(this,a0);var aZ=X.createRange(a0);aZ.collapseToPoint(a0,a1);this.setSingleRange(aZ);this.isCollapsed=true};O.collapseToStart=function(){if(this.rangeCount){var aZ=this._ranges[0];this.collapse(aZ.startContainer,aZ.startOffset)}else{throw new aK("INVALID_STATE_ERR")}};O.collapseToEnd=function(){if(this.rangeCount){var aZ=this._ranges[this.rangeCount-1];this.collapse(aZ.endContainer,aZ.endOffset)}else{throw new aK("INVALID_STATE_ERR")}};O.selectAllChildren=function(a0){aQ(this,a0);var aZ=X.createRange(a0);aZ.selectNodeContents(a0);this.setSingleRange(aZ)};O.deleteFromDocument=function(){if(W&&aJ&&this.docSelection.type==aX){var a3=this.docSelection.createRange();var a2;while(a3.length){a2=a3.item(0);a3.remove(a2);Q.removeNode(a2)}this.refresh()}else{if(this.rangeCount){var a0=this.getAllRanges();if(a0.length){this.removeAllRanges();for(var a1=0,aZ=a0.length;a1<aZ;++a1){a0[a1].deleteContents()}this.addRange(a0[aZ-1])}}}};O.eachRange=function(a2,a1){for(var a0=0,aZ=this._ranges.length;a0<aZ;++a0){if(a2(this.getRangeAt(a0))){return a1}}};O.getAllRanges=function(){var aZ=[];this.eachRange(function(a0){aZ.push(a0)});return aZ};O.setSingleRange=function(aZ,a0){this.removeAllRanges();this.addRange(aZ,a0)};O.callMethodOnEachRange=function(aZ,a1){var a0=[];this.eachRange(function(a2){a0.push(a2[aZ].apply(a2,a1||[]))});return a0};function aR(aZ){return function(a1,a2){var a0;if(this.rangeCount){a0=this.getRangeAt(0);a0["set"+(aZ?"Start":"End")](a1,a2)}else{a0=X.createRange(this.win.document);a0.setStartAndEnd(a1,a2)}this.setSingleRange(a0,this.isBackward())}}O.setStart=aR(true);O.setEnd=aR(false);X.rangePrototype.select=function(aZ){al(this.getDocument()).setSingleRange(this,aZ)};O.changeEachRange=function(a0){var aZ=[];var a1=this.isBackward();this.eachRange(function(a2){a0(a2);aZ.push(a2)});this.removeAllRanges();if(a1&&aZ.length==1){this.addRange(aZ[0],"backward")}else{this.setRanges(aZ)}};O.containsNode=function(a0,aZ){return this.eachRange(function(a1){return a1.containsNode(a0,aZ)},true)||false};O.getBookmark=function(aZ){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[aZ])}};O.moveToBookmark=function(a3){var aZ=[];for(var a2=0,a1,a0;a1=a3.rangeBookmarks[a2++];){a0=X.createRange(this.win);a0.moveToBookmark(a1);aZ.push(a0)}if(a3.backward){this.setSingleRange(aZ[0],"backward")}else{this.setRanges(aZ)}};O.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};O.restoreRanges=function(aZ){this.removeAllRanges();for(var a1=0,a0;a0=aZ.ranges[a1];++a1){this.addRange(a0,(aZ.backward&&a1==0))}};O.toHtml=function(){var aZ=[];this.eachRange(function(a0){aZ.push(aP.toHtml(a0))});return aZ.join("")};if(ab.implementsTextRange){O.getNativeTextRange=function(){var a1,a0;if((a1=this.docSelection)){var aZ=a1.createRange();if(az(aZ)){return aZ}else{throw R.createError("getNativeTextRange: selection is a control selection")}}else{if(this.rangeCount>0){return X.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}else{throw R.createError("getNativeTextRange: selection contains no range")}}}}function ai(a5){var a4=[];var a2=new ar(a5.anchorNode,a5.anchorOffset);var a0=new ar(a5.focusNode,a5.focusOffset);var a1=(typeof a5.getName=="function")?a5.getName():"Selection";if(typeof a5.rangeCount!="undefined"){for(var a3=0,aZ=a5.rangeCount;a3<aZ;++a3){a4[a3]=aP.inspect(a5.getRangeAt(a3))}}return"["+a1+"(Ranges: "+a4.join(", ")+")(anchor: "+a2.inspect()+", focus: "+a0.inspect()+"]"}O.getName=function(){return"WrappedSelection"};O.inspect=function(){return ai(this)};O.detach=function(){aN(this.win,"delete");ap(this)};au.detachAll=function(){aN(null,"deleteAll")};au.inspect=ai;au.isDirectionBackward=U;X.Selection=au;X.selectionPrototype=O;X.addShimListener(function(aZ){if(typeof aZ.getSelection=="undefined"){aZ.getSelection=function(){return al(aZ)}}aZ=null})});var e=false;var L=function(O){if(!e){e=true;if(!h.initialized&&h.config.autoInitialize){K()}}};if(C){if(document.readyState=="complete"){L()}else{if(D(document,"addEventListener")){document.addEventListener("DOMContentLoaded",L,false)}i(window,"load",L)}}return h},this);(function(p,d){var c=window||{},b=p.rangy||c.rangy,l,g;p.rangy=b;var i="br",v="p",r="insertType",q="deleteType",h=[{start:0,end:31},{start:33,end:40},{start:45,end:45},{start:91,end:93},{start:112,end:123},{start:144,end:145}];l={attributes:{changeId:"data-cid",userId:"data-userid",userName:"data-username",sessionId:"data-session-id",time:"data-time",lastTime:"data-last-change-time",changeData:"data-changedata"},attrValuePrefix:"",blockEl:"p",blockEls:["div","p","ol","ul","li","h1","h2","h3","h4","h5","h6","blockquote"],stylePrefix:"cts",currentUser:{id:null,name:null},changeTypes:{insertType:{tag:"ins",alias:"ins",action:"Inserted"},deleteType:{tag:"del",alias:"del",action:"Deleted"}},contentEditable:undefined,_isTracking:true,tooltips:false,tooltipsDelay:1,_isVisible:true,_changeData:null,_handleSelectAll:false,_sessionId:null};function n(B){if(!B){return true}var A,z=h.length,C;for(A=0;A<z;++A){C=h[A];if(B>=C.start&&B<=C.end){return true}}return false}g=function(A){A||(A={});if(!A.element){throw new Error("options.element must be defined for ice construction.")}this._changes={};this._userStyles={};this.currentUser={name:"",id:""};this._styles={};this._savedNodesMap={};this.$this=d(this);this._browser=p.dom.browser();this._tooltipMouseOver=this._tooltipMouseOver.bind(this);this._tooltipMouseOut=this._tooltipMouseOut.bind(this);d.extend(true,this,l,A);if(A.tooltips&&(!d.isFunction(A.hostMethods.showTooltip)||!d.isFunction(A.hostMethods.hideTooltip))){throw new Error("hostMethods.showTooltip and hostMethods.hideTooltip must be defined if tooltips is true")}var B=A.userStyles||{};for(var C in B){if(B.hasOwnProperty(C)){var z=B[C];if(!isNaN(z)){this._userStyles[C]=this.stylePrefix+"-"+z;this._uniqueStyleIndex=Math.max(z,this._uniqueStyleIndex);this._styles[z]=true}}}u=A.hostMethods.logError||function(){return undefined};this._insertSelector="."+this._getIceNodeClass(r);this._deleteSelector="."+this._getIceNodeClass(q);this._iceSelector=this._insertSelector+","+this._deleteSelector};g.prototype={_uniqueStyleIndex:0,_browserType:null,_batchChangeId:null,_uniqueIDIndex:1,_delBookmark:"tempdel",isPlaceHoldingDeletes:false,startTracking:function(z){if(typeof(this.contentEditable)=="boolean"){this.element.setAttribute("contentEditable",this.contentEditable)}this.initializeEnvironment();this.initializeEditor();this.initializeRange();this._updateTooltipsState();return this},stopTracking:function(A){this._isTracking=false;try{var z=this.element;if(z){this.unlistenToEvents()}if(!A&&(typeof(this.contentEditable)!=="undefined")){this.element.setAttribute("contentEditable",!this.contentEditable)}}catch(z){u(z,"While trying to stop tracking")}this._updateTooltipsState();return this},listenToEvents:function(){if(this.element&&!this._boundEventHandler){this.unlistenToEvents();this._boundEventHandler=this.handleEvent.bind(this);this.element.addEventListener("keydown",this._boundEventHandler,true)}},unlistenToEvents:function(){if(this.element&&this._boundEventHandler){this.element.removeEventListener("keydown",this._boundEventHandler,true)}this._boundEventHandler=null},initializeEnvironment:function(){this.env||(this.env={});this.env.element=this.element;this.env.document=this.element.ownerDocument;this.env.window=this.env.document.defaultView||this.env.document.parentWindow||window;this.env.frame=this.env.window.frameElement;this.env.selection=this.selection=new p.Selection(this.env)},initializeRange:function(){},initializeEditor:function(){this._loadFromDom();this._updateTooltipsState()},isTracking:function(){return this._isTracking},enableChangeTracking:function(){this._isTracking=true},disableChangeTracking:function(){this._isTracking=false},toggleChangeTracking:function(z){z=(undefined===z)?!this._isTracking:Boolean(z);this._isTracking=z},getCurrentUser:function(){var z=this.currentUser||{},A=(z.id===null||z.id===undefined)?"":String(z.id);return{name:z.name||"",id:A}},setCurrentUser:function(E){var B={};E=E||{};B.name=E.name?String(E.name):"";if(E.id!==undefined&&E.id!==null){B.id=String(E.id)}else{B.id=""}this.currentUser=B;for(var D in this._changes){var F=this._changes[D];if(F.userid==B.id){F.username=B.name}}var A=this.getIceNodes(),C,z=this.attributes.userId;A.each((function(G,H){C=H.getAttribute(z);if(C===null||C===B.id){H.setAttribute(this.attributes.userName,B.name)}}).bind(this))},setSessionId:function(z){this._sessionId=z},toggleTooltips:function(z){z=(undefined===z)?!this.tooltips:Boolean(z);this.tooltips=z;this._updateTooltipsState()},visible:function(z){if(z.nodeType===p.dom.TEXT_NODE){z=z.parentNode}var A=z.getBoundingClientRect();return(A.top>0&&A.left>0)},_createIceNode:function(z,A,C){var B=this.env.document.createElement(this.changeTypes[z].tag);B.setAttribute("class",this._getIceNodeClass(z));if(A){B.appendChild(A)}this._addChange(z,[B],C);return B},insert:function(H){this.hostMethods.beforeInsert&&this.hostMethods.beforeInsert();var B=this.getCurrentRange(),C=this._isRangeInElement(B,this.element),A=C?null:this.hostMethods.getHostRange(),G=this._startBatchChange(),F=Boolean(C&&!C.collapsed),E=false;H=H||{};try{if(F){this._deleteContents(false,C);C=this.getCurrentRange()}if(C||A){var z=H.nodes;if(z&&!d.isArray(z)){z=[z]}this._moveRangeToValidTrackingPos(C,A);E=this._insertNodes(C,A,{nodes:z,text:H.text,insertStubText:H.insertStubText!==false})}}catch(D){u(D,"while trying to insert nodes")}finally{this._endBatchChange(G,z||H.text||E)}return E},_deleteContents:function(C,A){var z=true,F,B=this._browser;this.hostMethods.beforeDelete&&this.hostMethods.beforeDelete();if(A){this.selection.addRange(A)}else{A=this.getCurrentRange()}F=this._startBatchChange();try{if(A.collapsed===false){A=this._deleteSelection(A);if(A&&!this.visible(A.endContainer)){A.setEnd(A.endContainer,Math.max(0,A.endOffset-1));A.collapse(false)}}else{this._cleanupSelection(A,false,true);if(this._isCurrentUserIceNode(this._getIceNode(A.startContainer,r))){return false}if(C){if(B.type==="mozilla"){z=this._deleteRight(A);if(!this.visible(A.endContainer)){if(A.endContainer.parentNode.nextSibling){A.setEndBefore(A.endContainer.parentNode.nextSibling)}else{A.setEndAfter(A.endContainer)}A.collapse(false)}}else{if(A.endOffset===p.dom.getNodeCharacterLength(A.endContainer)){var D=A.startContainer.nextSibling;if(d(D).is(this._deleteSelector)){while(D){if(d(D).is(this._deleteSelector)){D=D.nextSibling;continue}A.setStart(D,0);A.collapse(true);break}}}z=this._deleteRight(A);if(!this.visible(A.endContainer)){if(d(A.endContainer.parentNode).is(this._iceSelector)){A.setStartAfter(A.endContainer.parentNode);A.collapse(true)}}}}else{if(B.mozilla){z=this._deleteLeft(A);if(!this.visible(A.startContainer)){if(A.startContainer.parentNode.previousSibling){A.setEnd(A.startContainer.parentNode.previousSibling,0)}else{A.setEnd(A.startContainer.parentNode,0)}A.moveEnd(p.dom.CHARACTER_UNIT,p.dom.getNodeCharacterLength(A.endContainer));A.collapse(false)}}else{if(!this.visible(A.startContainer)){if(A.endOffset===p.dom.getNodeCharacterLength(A.endContainer)){var E=A.startContainer.previousSibling;if(d(E).is(this._deleteSelector)){while(E){if(d(E).is(this._deleteSelector)){E=E.prevSibling;continue}A.setEndBefore(E.nextSibling,0);A.collapse(false);break}}}}z=this._deleteLeft(A)}}}A&&this.selection.addRange(A)}finally{this._endBatchChange(F,z)}return z},getChanges:function(z){var A=z?this._filterChanges(z):this._changes;return d.extend({},A)},getChangeUserids:function(){var A=this,B=Object.keys(this._changes),z=B.map(function(C){return A._changes[B[C]].userid});return z.sort().filter(function(E,D,C){if(D===C.indexOf(E)){return 1}return 0})},getElementContent:function(){return this.element.innerHTML},getCleanContent:function(z,C,A){var B=this.getCleanDOM(z,{callback:C,prepare:A,clone:true});return(B&&B.innerHTML)||""},getCleanDOM:function(z,B){var C="",A=this;B=B||{};d.each(this.changeTypes,function(E,D){if(E!==q){if(D>0){C+=","}C+="."+A._getIceNodeClass(E)}});if(z){if(typeof z==="string"){z=d("<div>"+z+"</div>")}else{if(B.clone){z=d(z).clone()[0]}}}else{z=B.clone?d(this.element).clone()[0]:this.element}return this._cleanBody(z,C,B)},_cleanBody:function(z,E,A){z=A.prepare?A.prepare.call(this,z):z;var D=d(z),C,B=D.find(E);d.each(B,function(F,G){while(G.firstChild){G.parentNode.insertBefore(G.firstChild,G)}G.parentNode.removeChild(G)});D.find(this._deleteSelector).remove();z=A.callback?A.callback.call(this,z):z;return z},acceptAll:function(z){if(z){return this._acceptRejectSome(z,true)}else{this.getCleanDOM(this.element,{clone:false});this._changes={};this._triggerChange({isText:true})}},rejectAll:function(C){if(C){return this._acceptRejectSome(C,false)}else{var E=this._insertSelector,z=this._deleteSelector,D,B=this,A=d(this.element);A.find(E).each(function(F,G){B._removeNode(G)});A.find(z).each(function(F,G){D=p.dom.contents(G);p.dom.replaceWith(G,D);d.each(D,function(H,J){var I=J&&J.parentNode;B._normalizeNode(I)})});this._changes={};this._triggerChange({isText:true})}},acceptChange:function(z){this.acceptRejectChange(z,{isAccept:true})},rejectChange:function(z){this.acceptRejectChange(z,{isAccept:false})},acceptRejectChange:function(M,C){var I,S,Q,N,J,W,U,R=p.dom,V,G=this,E,P,O,H=d(this.element),z=this._userStyles,B,A=this.attributes.userId,T=this._getIceNodeClass(q),D=this._getIceNodeClass(r),K=C&&C.isAccept,L=C&&(C.notify===false);if(!M){var F=this.getCurrentRange();if(!F||!F.collapsed){return}M=F.startContainer}I=N="."+T;S=J="."+D;if(!K){N=S;J=I}Q=I+","+S;W=R.getNode(M,Q);E=W.getAttribute(this.attributes.changeId);U=H.find(N+"["+this.attributes.changeId+"="+E+"]");V=U.length;U.each(function(Y,X){G._removeNode(X)});U=H.find(J+"["+this.attributes.changeId+"="+E+"]");V+=U.length;d.each(U,function(X,Y){if(o(Y)){return e(Y)}B=Y.getAttribute(A);O=B!==null?z[B]||"":"";P=p.dom.contents(Y);d(Y).removeClass(D+" "+T+" "+O);R.replaceWith(Y,P);d.each(P,function(aa,ad){var Z=p.dom.TEXT_NODE==ad.nodeType&&ad.nodeValue;if(Z){var ac=false;while(Z.indexOf("  ")>=0){ac=true;Z=Z.replace("  "," \u00a0")}if(ac){ad.nodeValue=Z}}var ab=ad&&ad.parentNode;G._normalizeNode(ab)})});delete this._changes[E];if(V>0&&!L){this._triggerChange({isText:true})}},isInsideChange:function(B,A,z){try{return Boolean(this.currentChangeNode(B,A,z))}catch(C){u(C,"While testing if isInsideChange");return false}},getIceNodes:function(){var A=[];var z=this;d.each(this.changeTypes,function(B){A.push("."+z._getIceNodeClass(B))});A=A.join(",");return d(this.element).find(A)},_getIceNode:function(B,A){var z=this.changeTypes[A].tag+"."+this._getIceNodeClass(A);return p.dom.getNode((B&&B.$)||B,z)},_isNodeOfChangeType:function(B,A){if(!B){return false}var z="."+this._getIceNodeClass(A);return d(B.$||B).is(z)},_isInsertNode:function(z){return this._isNodeOfChangeType(z,r)},_isDeleteNode:function(z){return this._isNodeOfChangeType(z,q)},_normalizeNode:function(z){return p.dom.normalizeNode(z,this._browser.msie)},_moveRangeToValidTrackingPos:function(G,C){if(!(G=(C||G))){return}var z,A,E=-1,B,I=[],J,F,D=C?this.hostMethods.getHostNode:f,K=false;while(!K){A=G.startContainer;if(!A||I.indexOf(A)>=0){return}B=D(A);I.push(A);z=this._getVoidElement({node:B,checkEmpty:false});if(z){if((z!==A)&&(I.indexOf(z)>=0)){return}I.push(z)}else{K=p.dom.isTextContainer(B)}if(!K){if(-1==E){E=!t(D(G.startContainer),G.startOffset)}J=E?p.dom.findPrevTextContainer(z||B,this.element):p.dom.findNextTextContainer(z||B,this.element);F=J.node;if(C){F=this.hostMethods.makeHostElement(F)}try{if(E){G.setStart(F,J.offset)}else{G.setEnd(F,J.offset)}G.collapse(E)}catch(H){u(H,"While trying to move range to valid tracking position");break}}}},_isRangeInElement:function(z,A){var B=z&&z.startContainer;while(B){if(B==A){return z}B=B.parentNode}return null},_getVoidElement:function(A){if(!A){return null}var C=A.node,B=A.checkEmpty!==false;try{var z=this._getIceNode(C,q);if(!z){if(3==C.nodeType&&(B&&C.nodeValue=="\u200B")){return C}}return z}catch(D){u(D,"While trying to get void element of",C);return null}},_cleanupSelection:function(A,z,C){var D;if(!A||!A.collapsed||!(D=A.startContainer)){return}if(z){D=this.hostMethods.getHostNode(D)}var B=D.nodeType;if(p.dom.TEXT_NODE==B){return this._cleanupTextSelection(A,D,z,C)}else{return this._cleanupElementSelection(A,z)}},_cleanupTextSelection:function(A,F,z,E){this._cleanupAroundNode(F);if(E&&p.dom.isEmptyTextNode(F)){var B=F.parentNode,D=p.dom.getNodeIndex(F),C=z?this.hostMethods.makeHostElement:f;B.removeChild(F);D=Math.max(0,D);A.setStart(C(B),D);A.setEnd(C(B),D)}},_cleanupElementSelection:function(D,B){var z,F=false,H=B?this.hostMethods.getHostNode(D.startContainer):D.startContainer,C=H.childNodes.length;if(C<1){return}try{if(D.startOffset>0){z=H.childNodes[D.startOffset-1]}else{z=H.firstChild;F=true}if(!z){return}}catch(G){return}this._cleanupAroundNode(z,F);if(D.startOffset===0){return}var A=p.dom.getNodeIndex(z)+1;if(p.dom.isEmptyTextNode(z)){A=Math.max(0,A-1);H.removeChild(z)}if(H.childNodes.length!==C){var E=B?this.hostMethods.makeHostElement:f;D.setStart(E(H),A);D.setEnd(E(H),A)}},_cleanupAroundNode:function(C,D){var B=C.parentNode,z=C.nextSibling,E,A;while(z){E=(d(z).is(this._iceSelector)&&p.dom.hasNoTextOrStubContent(z))||p.dom.isEmptyTextNode(z);if(E){A=z;z=z.nextSibling;B.removeChild(A)}else{z=z.nextSibling}}z=C.previousSibling;while(z){E=(d(z).is(this._iceSelector)&&p.dom.hasNoTextOrStubContent(z))||p.dom.isEmptyTextNode(z);if(E){A=z;z=z.previousSibling;B.removeChild(A)}else{z=z.previousSibling}}if(D&&p.dom.isEmptyTextNode(C)){B.removeChild(C)}},_isCurrentUserIceNode:function(A){var z=Boolean(A&&d(A).attr(this.attributes.userId)===this.currentUser.id);if(z&&this._sessionId){z=A.getAttribute(this.attributes.sessionId)===this._sessionId}return z},_getChangeTypeFromAlias:function(A){var B,z=null;for(B in this.changeTypes){if(this.changeTypes.hasOwnProperty(B)){if(this.changeTypes[B].alias==A){z=B}}}return z},_getIceNodeClass:function(z){return this.attrValuePrefix+this.changeTypes[z].alias},_getUserStyle:function(z){if(z===null||z===""||"undefined"==typeof z){return this.stylePrefix}var A=null;if(this._userStyles[z]){A=this._userStyles[z]}else{A=this._setUserStyle(z,this._getNewStyleId())}return A},_setUserStyle:function(z,B){var A=this.stylePrefix+"-"+B;if(!this._styles[B]){this._styles[B]=true}return this._userStyles[z]=A},_getNewStyleId:function(){var z=++this._uniqueStyleIndex;if(this._styles[z]){return this._getNewStyleId()}else{this._styles[z]=true;return z}},_addChange:function(C,E,B){var D=B||this._batchChangeId||this.getNewChangeId(),z=this;if(!this._changes[D]){var A=(new Date()).getTime();this._changes[D]={type:C,time:A,lastTime:A,sessionId:this._sessionId,userid:String(this.currentUser.id),username:this.currentUser.name,data:this._changeData||""};this._triggerChange({text:false})}d.each(E,function(F){z._addNodeToChange(D,E[F])});return D},_addNodeToChange:function(D,C){var E=this.getChange(D),A={};if(!C.getAttribute(this.attributes.changeId)){A[this.attributes.changeId]=D}var B=C.getAttribute(this.attributes.userId);if(!B){B=E.userid;A[this.attributes.userId]=B}if(B==E.userid){A[this.attributes.userName]=E.username}var z=C.getAttribute(this.attributes.changeData);if(null===z){A[this.attributes.changeData]=this._changeData||""}if(!C.getAttribute(this.attributes.time)){A[this.attributes.time]=E.time}if(!C.getAttribute(this.attributes.lastTime)){A[this.attributes.lastTime]=E.lastTime}if(E.sessionId&&!C.getAttribute(this.attributes.sessionId)){A[this.attributes.sessionId]=E.sessionId}if(!E.style){E.style=this._getUserStyle(E.userid)}d(C).attr(A).addClass(E.style);this._updateNodeTooltip(C)},getChange:function(z){return this._changes[z]||null},getNewChangeId:function(){var z=++this._uniqueIDIndex;if(this._changes[z]){z=this.getNewChangeId()}return z},_startBatchChange:function(){return this._batchChangeId?null:(this._batchChangeId=this.getNewChangeId())},getContentElement:function(){return this.element},_endBatchChange:function(A,z){if(A&&(A===this._batchChangeId)){this._batchChangeId=null;if(z){this._triggerChange({isText:true})}}},getCurrentRange:function(){try{return this.selection.getRangeAt(0)}catch(z){u(z,"While trying to get current range");return null}},_insertNodes:function(A,N,O){var L=N||A,X=O||{},T=L.startContainer,F=(T&&T.$)||T,U=N?this.hostMethods.makeHostElement:f,P=X.nodes,W=X.insertStubText!==false,K=X.text,R,S,Y=this.env.document,D=false;var M=this._getIceNode(F,r),C=this._isCurrentUserIceNode(M);this._cleanupSelection(L,Boolean(N),true);if(C){var G=P&&P[0],I=M.getAttribute(this.attributes.changeId);if(G){D=true;L.insertNode(U(G));var J=G.parentNode,V=G.nextSibling;S=P.length;for(R=1;R<S;++R){if(V){J.insertBefore(P[R],V)}else{J.appendChild(P[R])}}var H=P[S-1];if(p.dom.TEXT_NODE==H.nodeType){L.setEnd(H,(H.nodeValue&&H.nodeValue.length)||0)}else{L.setEndAfter(H)}L.collapse();if(N){this.hostMethods.setHostRange(N)}else{this.selection.addRange(L)}}else{w(null,L,Y,true)}this._updateChangeTime(I)}else{var Q=this._createIceNode(r);if(M){var z=M.childNodes.length;this._normalizeNode(M);if(z!==M.childNodes.length){if(N){N=L=this.hostMethods.getHostRange()}else{L.refresh()}}if(M){var E=(N&&this.hostMethods.getHostNode(N.endContainer))||L.endContainer;if((E.nodeType==3&&L.endOffset<L.endContainer.length)||(E!==M.lastChild)){M=this._splitNode(M,L.endContainer,L.endOffset)}}}if(M){L.setStartAfter(U(M));L.collapse(true)}L.insertNode(U(Q));S=(P&&P.length)||0;if(S){D=true;for(R=0;R<S;++R){Q.appendChild(P[R])}L.setEndAfter(U(Q.lastChild));L.collapse()}else{if(K){D=true;var B=Y.createTextNode(K);Q.appendChild(B);L.setEnd(B,1);L.collapse()}else{w(Q,L,Y,W)}}if(N){this.hostMethods.setHostRange(N)}else{this.selection.addRange(L)}}return D},_updateChangeTime:function(D){var C=this._changes[D];if(C){var B=(new Date()).getTime(),A=d(this.element).find("["+this.attributes.changeId+"="+D+"]"),z=this.attributes.lastTime;C.lastTime=B;A.each(function(E,F){F.setAttribute(z,B)})}},_handleVoidEl:function(A,z){var B=A&&this._getVoidElement({node:A});if(B&&!this._getIceNode(B,q)){z.collapse(true);return true}return false},_deleteSelection:function(G){var H=new p.Bookmark(this.env,G),z=p.dom.getElementsBetween(H.start,H.end),J=[],I=[],K={deleteNodesCollection:I,moveLeft:true,range:null};for(var F=0;F<z.length;F++){var C=z[F];if(!C||!C.parentNode){continue}if(p.dom.isBlockElement(C)){J.push(C);if(!p.dom.canContainTextElement(C)){for(var D=0;D<C.childNodes.length;D++){z.push(C.childNodes[D])}continue}}if(p.dom.isEmptyTextNode(C)){this._removeNode(C);continue}if(!this._getVoidElement({node:C})){if(C.nodeType!==p.dom.TEXT_NODE){if(x(C)){this._addDeleteTrackingToBreak(C,K);continue}if(p.dom.isStubElement(C)){this._addDeleteTracking(C,K);continue}if(p.dom.hasNoTextOrStubContent(C)){this._removeNode(C);continue}for(var E=0;E<C.childNodes.length;E++){var B=C.childNodes[E];z.push(B)}continue}var A=p.dom.getBlockParent(C);this._addDeleteTracking(C,K);if(p.dom.hasNoTextOrStubContent(A)){p.dom.remove(A)}}}if(I.length){H.remove();this._cleanupAroundNode(I[0]);G.setStartBefore(I[0]);G.collapse(true);this.selection.addRange(G)}else{H.selectStartAndCollapse();if(G=this.getCurrentRange()){this._cleanupSelection(G,false,false);G=this.getCurrentRange()}}return G},_deleteRight:function(J){var A=p.dom.isBlockElement(J.startContainer)&&J.startContainer||p.dom.getBlockParent(J.startContainer,this.element)||null,L=A?(p.dom.hasNoTextOrStubContent(A)):false,H=A&&p.dom.getNextContentNode(A,this.element),M=H?(p.dom.hasNoTextOrStubContent(H)):false,E=J.endContainer,D=J.endOffset,N,B=J.commonAncestorContainer,F,Q=false;if(L){return false}if(x(B)){this._addDeleteTrackingToBreak(B,{range:J});return true}if(B.nodeType!==p.dom.TEXT_NODE){if(D===0&&p.dom.isBlockElement(B)&&(!p.dom.canContainTextElement(B))){var P=B.firstElementChild;if(P){J.setStart(P,0);J.collapse();return this._deleteRight(J)}}if(B.childNodes.length>D){var K=B.childNodes[D];if(x(K)){this._addDeleteTrackingToBreak(K,{range:J});return true}J.setStart(B.childNodes[D],0);J.collapse(true);Q=this._deleteRight(J);J.refresh();return Q}else{F=p.dom.getNextContentNode(B,this.element);if(F){if(x(F)){this._addDeleteTrackingToBreak(F,{range:J});return true}J.setEnd(F,0)}J.collapse();return this._deleteRight(J)}}try{J.moveEnd(p.dom.CHARACTER_UNIT,1);J.moveEnd(p.dom.CHARACTER_UNIT,-1)}catch(O){}if(D===E.data.length&&(!p.dom.hasNoTextOrStubContent(E))){F=p.dom.getNextNode(E,this.element);if(!F){J.selectNodeContents(E);J.collapse();return false}if(x(F)){this._addDeleteTrackingToBreak(F,{range:J});return true}if(F.nodeType===p.dom.TEXT_NODE){F=F.parentNode}if(!F.isContentEditable){Q=this._addDeleteTracking(F,{range:null,moveLeft:false,merge:true});var C=this.env.document.createTextNode("");F.parentNode.insertBefore(C,F.nextSibling);J.selectNode(C);J.collapse(true);return Q}if(this._handleVoidEl(F,J)){return true}if(p.dom.isChildOf(F,A)&&p.dom.isStubElement(F)){return this._addDeleteTracking(F,{range:J,moveLeft:false,merge:true})}}if(this._handleVoidEl(F,J)){return true}if(p.dom.isOnBlockBoundary(J.startContainer,J.endContainer,this.element)){if(this.mergeBlocks&&d(p.dom.getBlockParent(F,this.element)).is(this.blockEl)){if(H!==p.dom.getBlockParent(J.endContainer,this.element)){J.setEnd(H,0)}var I=p.dom.getElementsBetween(J.startContainer,J.endContainer);for(N=0;N<I.length;N++){p.dom.remove(I[N])}return p.dom.mergeBlockWithSibling(J,p.dom.getBlockParent(J.endContainer,this.element)||A)}else{if(M){p.dom.remove(H);J.collapse(true);return true}J.setStart(H,0);J.collapse(true);return true}}var z=J.endContainer,G=m(z,J.endOffset,1);return this._addDeleteTracking(G,{range:J,moveLeft:false,merge:true})},_deleteLeft:function(H){var D=p.dom.isBlockElement(H.startContainer)&&H.startContainer||p.dom.getBlockParent(H.startContainer,this.element)||null,G=D?p.dom.hasNoTextOrStubContent(D):false,A=D&&p.dom.getPrevContentNode(D,this.element),C=A?p.dom.hasNoTextOrStubContent(A):false,M=H.startContainer,B=H.startOffset,P=H.commonAncestorContainer,O,L;if(G){return false}if(x(P)){this._addDeleteTrackingToBreak(P,{range:H,moveLeft:true});return true}if(B===0||P.nodeType!==p.dom.TEXT_NODE){if(p.dom.isBlockElement(P)&&(!p.dom.canContainTextElement(P))){if(B===0){var K=P.firstElementChild;if(K){H.setStart(K,0);H.collapse();return this._deleteLeft(H)}}else{var N=P.lastElementChild;if(N){O=H.getLastSelectableChild(N);if(O){H.setStart(O,O.data.length);H.collapse();return this._deleteLeft(H)}}}}if(B===0){L=p.dom.getPrevContentNode(M,this.element)}else{L=P.childNodes[B-1]}if(!L){return false}if(d(L).is(this._iceSelector)&&L.childNodes.length>0&&L.lastChild){L=L.lastChild}if(x(L)){this._addDeleteTrackingToBreak(L,{range:H,moveLeft:true});return true}if(L.nodeType===p.dom.TEXT_NODE){L=L.parentNode}if(!L.isContentEditable){var z=this._addDeleteTracking(L,{range:null,moveLeft:true,merge:true});var E=document.createTextNode("");L.parentNode.insertBefore(E,L);H.selectNode(E);H.collapse(true);return z}if(this._handleVoidEl(L,H)){return true}if(p.dom.isStubElement(L)&&p.dom.isChildOf(L,D)||!L.isContentEditable){this._addDeleteTracking(L,{range:H,moveLeft:true,merge:true});return true}if(p.dom.isStubElement(L)){p.dom.remove(L);H.collapse(true);return false}if(L!==D&&!p.dom.isChildOf(L,D)){if(!p.dom.canContainTextElement(L)){L=L.lastElementChild}if(L.lastChild&&L.lastChild.nodeType!==p.dom.TEXT_NODE&&p.dom.isStubElement(L.lastChild)&&L.lastChild.tagName!=="BR"){H.setStartAfter(L.lastChild);H.collapse(true);return true}O=H.getLastSelectableChild(L);if(O&&!p.dom.isOnBlockBoundary(H.startContainer,O,this.element)){H.selectNodeContents(O);H.collapse();return true}}}if(B===1&&!p.dom.isBlockElement(P)&&H.startContainer.childNodes.length>1&&H.startContainer.childNodes[0].nodeType===p.dom.TEXT_NODE&&H.startContainer.childNodes[0].data.length===0){H.setStart(H.startContainer,0);return this._deleteLeft(H)}try{H.moveStart(p.dom.CHARACTER_UNIT,-1);H.moveStart(p.dom.CHARACTER_UNIT,1)}catch(J){}if(p.dom.isOnBlockBoundary(H.startContainer,H.endContainer,this.element)){if(C){p.dom.remove(A);H.collapse();return true}if(A&&A.lastChild&&p.dom.isStubElement(A.lastChild)){H.setStartAfter(A.lastChild);H.collapse(true);return true}O=H.getLastSelectableChild(A);if(O){H.setStart(O,O.data.length);H.collapse(true)}else{if(A){H.setStart(A,A.childNodes.length);H.collapse(true)}}return true}var F=H.startContainer;if(F&&(F.nodeType===p.dom.TEXT_NODE)){var I=m(F,H.startOffset-1,1);this._addDeleteTracking(I,{range:H,moveLeft:true,merge:true});return true}return false},_removeNode:function(A){var z=A&&A.parentNode;if(z){z.removeChild(A);if(z!==this.element&&p.dom.hasNoTextOrStubContent(z)){this._removeNode(z)}}},_addDeleteTracking:function(C,I){var E=I&&I.moveLeft,F=this._getIceNode(C,r),G,D;I=I||{};if(F){return this._addDeletionInInsertNode(C,F,I)}D=I.range;if(D&&this._getIceNode(C,q)){return this._deleteInDeleted(C,I)}if(C.previousSibling&&p.dom.isEmptyTextNode(C.previousSibling)){C.parentNode.removeChild(C.previousSibling)}if(C.nextSibling&&p.dom.isEmptyTextNode(C.nextSibling)){C.parentNode.removeChild(C.nextSibling)}var A=this._getIceNode(C.previousSibling,q),H=this._getIceNode(C.nextSibling,q);if(A&&this._isCurrentUserIceNode(A)){G=A;G.appendChild(C);if(H&&this._isCurrentUserIceNode(H)){var B=p.dom.extractContent(H);G.appendChild(B);H.parentNode.removeChild(H)}}else{if(H&&this._isCurrentUserIceNode(H)){G=H;G.insertBefore(C,G.firstChild)}else{var z=this.getAdjacentChangeId(C,E);G=this._createIceNode(q,null,z);if(I.deleteNodesCollection){I.deleteNodesCollection.push(G)}C.parentNode.insertBefore(G,C);G.appendChild(C)}}if(D){if(p.dom.isStubElement(C)){D.selectNode(C)}else{D.selectNodeContents(C)}if(E){D.collapse(true)}else{D.collapse()}}if(G){this._normalizeNode(G);D&&D.refresh()}return true},_addDeleteTrackingToBreak:function(D,A){var C=Boolean(A&&A.moveLeft);function z(){var F=A&&A.range;if(F){if(x(D)||p.dom.hasNoTextOrStubContent(D)||C){if(C){F.setStartBefore(D);F.setEndBefore(D)}else{F.setStartAfter(D);F.setEndAfter(D)}}else{if(D.firstChild){F.setStartBefore(D.firstChild);F.setEndBefore(D.firstChild)}}F.collapse()}}if(!x(D)){u("addDeleteTracking to BR: not a break element");return}if(this._isDeleteNode(D)){return z()}e(D);var B=q;p.dom.addClass(D,this._getIceNodeClass(B));var E=this.getAdjacentChangeId(D,C);this._addChange(B,[D],E);z()},_deleteInDeleted:function(B,H){var C=H.range,D=H.moveLeft,F;this._normalizeNode(B);var G=false;if(D){var z=p.dom.getPrevContentNode(B,this.element);while(!G){F=this._getIceNode(z,q);if(!F){G=true}else{z=p.dom.getPrevContentNode(z,this.element)}}if(z){var E=C.getLastSelectableChild(z);if(E){z=E}C.setStart(z,p.dom.getNodeCharacterLength(z));C.collapse(true)}}else{var A=p.dom.getNextContentNode(B,this.element);while(!G){F=this._getIceNode(A,q);if(!F){G=true}else{A=p.dom.getNextContentNode(A,this.element)}}if(A){C.selectNodeContents(A);C.collapse(true)}}return true},_addDeletionInInsertNode:function(C,G,L){var D=L&&L.range,E=L&&L.moveLeft;L=L||{};if(this._isCurrentUserIceNode(G)){if(D){if(E){D.setStartBefore(C)}else{D.setStartAfter(C)}D.collapse(E)}C.parentNode.removeChild(C);if(!this._browser.msie){this._normalizeNode(G)}var F=d(G),J=F.find(".iceBookmark").length,A;if(J>0){A=F.clone();A.find(".iceBookmark").remove();A=A[0]}else{A=G}if(p.dom.hasNoTextOrStubContent(A)){if(D){D.setStartBefore(G);D.collapse(true)}p.dom.replaceWith(G,p.dom.contents(G))}}else{var B=b.dom.getNodeIndex(C),I=C.parentNode,H=I.childNodes.length,K;I.removeChild(C);K=this._createIceNode(q);if(L.deleteNodesCollection){L.deleteNodesCollection.push(K)}K.appendChild(C);if(B>0&&B>=(H-1)){p.dom.insertAfter(G,K)}else{if(B>0){var z=this._splitNode(G,I,B);this._deleteEmptyNode(z)}G.parentNode.insertBefore(K,G)}this._deleteEmptyNode(G);if(D&&E){D.setStartBefore(K);D.collapse(true);this.selection.addRange(D)}if(L&&L.merge){this._mergeDeleteNode(K)}if(D){D.refresh()}}return true},_deleteEmptyNode:function(A){var z=A&&A.parentNode;if(z&&p.dom.hasNoTextOrStubContent(A)){z.removeChild(A)}},_mergeDeleteNode:function(B){var A,z;if(this._isCurrentUserIceNode(A=this._getIceNode(B.previousSibling,q))){z=p.dom.extractContent(B);B.parentNode.removeChild(B);A.appendChild(z);this._mergeDeleteNode(A)}else{if(this._isCurrentUserIceNode(A=this._getIceNode(B.nextSibling,q))){z=p.dom.extractContent(A);B.parentNode.removeChild(A);B.appendChild(z);this._mergeDeleteNode(B)}}},handleEvent:function(A){if(!this._isTracking){return true}var z=false;if("keypress"==A.type){z=this.keyPress(A)}else{if("keydown"==A.type){z=!this.handleKeyDown(A)}}if(z){A.stopImmediatePropagation();A.preventDefault()}return !z},_handleAncillaryKey:function(D){var C=this._browser,B=false,A=this,z=A.getCurrentRange();switch(D){case p.dom.DOM_VK_DELETE:B=this._deleteContents();break;case 46:B=this._deleteContents(true);break;case p.dom.DOM_VK_DOWN:case p.dom.DOM_VK_UP:case p.dom.DOM_VK_LEFT:if(C.type==="mozilla"){if(!this.visible(z.startContainer)){if(z.startContainer.parentNode.previousSibling){z.setEnd(z.startContainer.parentNode.previousSibling,0);z.moveEnd(p.dom.CHARACTER_UNIT,p.dom.getNodeCharacterLength(z.endContainer));z.collapse(false)}else{z.setEnd(z.startContainer.parentNode.nextSibling,0);z.collapse(false)}}}B=false;break;case p.dom.DOM_VK_RIGHT:if(C.type==="mozilla"){if(!this.visible(z.startContainer)){if(z.startContainer.parentNode.nextSibling){z.setStart(z.startContainer.parentNode.nextSibling,0);z.collapse(true)}}}break;default:break}return B},handleKeyDown:function(z){if(this._handleSpecialKey(z)){return true}return !this.keyPress(z)},onKeyDown:function(z){if(this._handleSpecialKey(z)){return false}return this._handleAncillaryKey(z)},keyPress:function(C){var E=null;if(C.ctrlKey||C.metaKey){return false}var z=this.getCurrentRange(),D,B=z&&p.dom.parents(z.startContainer,"br")[0]||null;if(B){z.moveToNextEl(B)}var A=C.keyCode?C.keyCode:C.which;switch(A){case 32:return this.insert({text:" "});case p.dom.DOM_VK_DELETE:case 46:case p.dom.DOM_VK_DOWN:case p.dom.DOM_VK_UP:case p.dom.DOM_VK_LEFT:case p.dom.DOM_VK_RIGHT:return this._handleAncillaryKey(A);case p.dom.DOM_VK_ENTER:this._handleEnter();return false;default:if(n(A)){return false}E=C["char"]||String.fromCharCode(A);if(E){var D=this._browser.msie?{text:E}:null;return this.insert(D)}return false}},_handleEnter:function(){var z=this.getCurrentRange();if(z&&!z.collapsed){this._deleteContents()}},_handleSpecialKey:function(A){var z=A.which;if(z===null){z=A.keyCode}switch(z){case 120:case 88:if(true===A.ctrlKey||true===A.metaKey){this.prepareToCut();return true}break;case 67:case 99:if(true===A.ctrlKey||true===A.metaKey){this.prepareToCopy();return true}break;default:break}return false},currentChangeNode:function(B,z,A){var C=this._iceSelector,F=null;if(!B){F=this.getCurrentRange();if(!F){return false}if(A!==false&&F.collapsed){this._cleanupSelection(F,false,false);B=F.startContainer}else{B=F.commonAncestorContainer}}var G=z?d(B).is(C)&&B:p.dom.getNode(B,C);if((!G)&&F&&F.collapsed){var E=F.endContainer,H=F.endOffset,D=null;if(E.nodeType===p.dom.TEXT_NODE){if(H===E.length){D=p.dom.getNextNode(E)}else{if(H===0){D=p.dom.getPrevNode(E,this.element)}}}else{if(E.nodeType===p.dom.ELEMENT_NODE){if(H===0){D=p.dom.getPrevNode(E,this.element)}else{if(E.childNodes.length>H){E=E.childNodes[H-1];if(d(E).is(C)){return E}D=p.dom.getNextNode(E)}}}}if(D){G=d(D).is(C)}}return G},setShowChanges:function(z){var A=d(this.element);z=Boolean(z);this._isVisible=z;A.toggleClass("ICE-Tracking",z);this._showTitles(z);this._updateTooltipsState()},reload:function(){this._loadFromDom()},hasChanges:function(){for(var z in this._changes){var A=this._changes[z];if(A&&A.type){return true}}return false},countChanges:function(z){var A=this._filterChanges(z);return A.count},setChangeData:function(z){if(null==z||(typeof z=="undefined")){z=""}this._changeData=String(z)},getDeleteClass:function(){return this._getIceNodeClass(q)},prepareToCopy:function(){var z=this.getCurrentRange();if(z&&!z.collapsed){this._removeTrackingInRange(z)}},prepareToCut:function(){var C=this.getCurrentRange(),z=this.hostMethods.getHostRange();if(C&&z&&C.collapsed&&!z.collapsed){try{var B=this.hostMethods.getHostRangeData(z);C.setStart(B.startContainer,B.startOffset);C.setEnd(B.endContainer,B.endOffset)}catch(D){return}}if(!C||C.collapsed){return false}k(C,this.element);var H=C.cloneContents(),A=C.cloneRange(),G=H.firstChild,E=H.lastChild;this.hostMethods.beforeEdit();C.collapse(false);C.insertNode(H);C.setStartBefore(G);C.setEndAfter(E);var F=this._startBatchChange();try{this._deleteSelection(C)}catch(D){u(D,"While trying to delete selection")}finally{this._endBatchChange(F);this.selection.addRange(A);this._removeTrackingInRange(A,false)}return true},toString:function(){return"ICE "+((this.element&&this.element.id)||"(no element id)")},_splitNode:function(D,G,z){var C=D.parentNode,A=b.dom.getNodeIndex(D),F=G.ownerDocument,B=F.createRange(),E;B.setStart(C,A);B.setEnd(G,z);E=B.extractContents();C.insertBefore(E,D);if(this.isInsideChange(D,true)){this._updateNodeTooltip(D.previousSibling)}return D.previousSibling},_triggerChange:function(z){if(this._isTracking){this.$this.trigger("change");if(z&&z.isText){this.$this.trigger("textChange")}}},_updateNodeTooltip:function(z){if(this.tooltips&&this._isVisible){this._addTooltip(z)}},_acceptRejectSome:function(B,z){var D=(function(F,G){this.acceptRejectChange(G,{isAccept:z,notify:false})}).bind(this);var C=this._filterChanges(B);for(var E in C.changes){var A=d(this.element).find("["+this.attributes.changeId+"="+E+"]");A.each(D)}if(C.count){this._triggerChange({isText:true})}},_filterChanges:function(J){var D=0,G={},F,K=J||{},B=K.filter,C=K.exclude?d.map(K.exclude,function(L){return String(L)}):null,A=K.include?d.map(K.include,function(L){return String(L)}):null,E=K.verify,z=null;for(var I in this._changes){F=this._changes[I];if(F&&F.type){var H=(B&&!B({userid:F.userid,time:F.time,data:F.data}))||(C&&C.indexOf(F.userid)>=0)||(A&&A.indexOf(F.userid)<0);if(!H){if(E){z=d(this.element).find("["+this.attributes.changeId+"]");H=!z.length}if(!H){++D;G[I]=F}}}}return{count:D,changes:G}},_loadFromDom:function(){this._changes={};this._uniqueStyleIndex=0;var E=this.currentUser&&this.currentUser.id,F=(this.currentUser&&this.currentUser.name)||"",B=(new Date()).getTime(),D,H=new RegExp(this.stylePrefix+"-(\\d+)"),z=[];for(var G in this.changeTypes){z.push(this._getIceNodeClass(G))}var A=this.getIceNodes();var C=function(N,J){var R=0,K,T="",N,I=J.className.split(" ");for(N=0;N<I.length;N++){D=H.exec(I[N]);if(D){K=D[0];R=D[1]}var U=new RegExp("("+z.join("|")+")").exec(I[N]);if(U){T=this._getChangeTypeFromAlias(U[1])}}var O=J.getAttribute(this.attributes.userId);var S;if(E&&(O==E)){S=F;J.setAttribute(this.attributes.userName,F)}else{S=J.getAttribute(this.attributes.userName)}this._setUserStyle(O,Number(R));var V=parseInt(J.getAttribute(this.attributes.changeId)||"");if(isNaN(V)){V=this.getNewChangeId();J.setAttribute(this.attributes.changeId,V)}var L=parseInt(J.getAttribute(this.attributes.time)||"");if(isNaN(L)){L=B}var Q=parseInt(J.getAttribute(this.attributes.lastTime)||"");if(isNaN(Q)){Q=L}var M=J.getAttribute(this.attributes.sessionId);var P=J.getAttribute(this.attributes.changeData)||"";this._changes[V]={type:T,style:K,userid:String(O),username:S,time:L,lastTime:Q,sessionId:M,data:P};this._updateNodeTooltip(J)}.bind(this);A.each(C);this._triggerChange()},_showTitles:function(A){var z=this.getIceNodes();if(A){d(z).each((function(B,C){this._updateNodeTooltip(C)}).bind(this))}else{d(z).removeAttr("title")}},_updateTooltipsState:function(){var A,z=this;if(this.tooltips&&this._isVisible){if(!this._showingTips){this._showingTips=true;A=this.getIceNodes();A.each(function(B,C){z._addTooltip(C)})}}else{if(this._showingTips){this._showingTips=false;A=this.getIceNodes();A.each(function(B,C){d(C).unbind("mouseover").unbind("mouseout")})}}},_addTooltip:function(z){d(z).unbind("mouseover").unbind("mouseout").mouseover(this._tooltipMouseOver).mouseout(this._tooltipMouseOut)},_tooltipMouseOver:function(C){var B=C.currentTarget,A=d(B),D,z=this;if(C.buttons||A.data("_tooltip_t")){return}D=setTimeout(function(){var F=z.currentChangeNode(B),H=F&&F.getAttribute(z.attributes.changeId),G=H&&z.getChange(H);if(G){var E=p.dom.hasClass(F,z._getIceNodeClass(r))?"insert":"delete";A.removeData("_tooltip_t");z.hostMethods.showTooltip(B,{userName:G.username,changeId:H,userId:G.userid,time:G.time,lastTime:G.lastTime,type:E})}},this.tooltipsDelay);A.data("_tooltip_t",D)},_tooltipMouseOut:function(B){var A=B.currentTarget,z=d(A),C=z.data("_tooltip_t");z.removeData("_tooltip_t");if(C){clearTimeout(C)}else{this.hostMethods.hideTooltip(A)}},_removeTrackingInRangeOld:function(B){var F=this._getIceNodeClass(r),A=this._getIceNodeClass(q),z="."+F+",."+A,C="data-ice-class",E=function(K){var J,I=null;if(K.nodeType==p.dom.TEXT_NODE){I=d(K).parents(z)}else{var H=d(K);if(H.is(z)){I=H}else{I=H.parents(z)}}J=(I&&I[0]);if(J){var G=J.className;J.setAttribute(C,G);J.setAttribute("class","ice-no-decoration");return true}return false};B.getNodes(null,E);var D=this.element;setTimeout(function(){var G=d(D).find("["+C+"]");G.each(function(I,J){var H=J.getAttribute(C);if(H){J.setAttribute("class",H);J.removeAttribute(C)}})},10)},_removeTrackingInRange:function(F){var D=this._getIceNodeClass(r),z=this._getIceNodeClass(q),E="."+D+",."+z,G=this._savedNodesMap,H="data-ice-class",A=Date.now()%1000000,B=function(O){var L,N,K=null;if(O.nodeType==p.dom.TEXT_NODE){K=d(O).parents(E)}else{L=d(O);if(L.is(E)){K=L}else{K=L.parents(E)}}if(N=(K&&K[0])){var M=y(N),I=N.className,J=String(A++);G[J]={attributes:M,className:I};j(N);N.setAttribute(H,J);N.setAttribute("class","ice-no-decoration");return true}return false};F.getNodes(null,B);var C=this.element;setTimeout(function(){var I=d(C).find("["+H+"]");I.each(function(L,M){var J=M.getAttribute(H),K=G[J];if(J){delete G[J];Object.keys(K.attributes).forEach(function(N){M.setAttribute(N,K.attributes[N])});M.setAttribute("class",K.className);M.removeAttribute(H)}else{u("missing save data for node")}})},10)},_onDomMutation:function(C){var D,B=C.length,A,F,z,E;for(D=0;D<B;++D){A=C[D];switch(A.type){case"childList":z=A.addedNodes;for(F=z.length-1;F>=0;--F){E=z[F];s.log("mutation: added node",E.tagName)}break}}},_setDomObserverTimeout:function(){var z=this;if(this._domObserverTimeout){window.clearTimeout(this._domObserverTimeout)}this._domObserverTimeout=window.setTimeout(function(){z._domObserverTimeout=null;z._domObserver.disconnect()},1)},getAdjacentChangeId:function(B,C){var A=C?p.dom.getNextNode(B):p.dom.getPrevNode(B),z,D=null;z=this._getIceNode(A,r)||this._getIceNode(A,q);if(!z){if(this._isInsertNode(A)||this._isDeleteNode(A)){z=A}}if(z&&this._isCurrentUserIceNode(z)){D=z.getAttribute(this.attributes.changeId)}return D}};var s=(window&&window.console)||{log:function(){},error:function(){},info:function(){},assert:function(){},count:function(){}};function y(E){var C=E.attributes,A,z=C&&C.length,B={};for(var D=0;D<z;++D){A=C[D];B[A.name]=A.value}return B}function j(B){var A=null,z;try{while(B.attributes.length>0){z=B.attributes[0];if(z===A){return}A=z;B.removeAttribute(z.name)}}catch(C){}}function f(z){return z}function e(A){var z=d.map(A.attributes,function(B){return B.name});d(A).removeClass();d.each(z,function(B,C){A.removeAttribute(C)})}function x(z){return i==p.dom.getTagName(z)}function o(A){var z=p.dom.getTagName(A);return i===z||v===z}function t(A,B){if(!A){return false}var z=A.nodeType;if(p.dom.TEXT_NODE==z){return B&&A.nodeValue&&(B>=A.nodeValue.length-1)}if(p.dom.ELEMENT_NODE==z){return A.childNodes&&A.childNodes.length&&(B>=A.childNodes.length)}return false}var u=null;function k(z,C){if(!z||!C||z.collapsed){return z}var B;try{while((B=z.endContainer)&&(B!==C)&&(z.endOffset==0)&&!z.collapsed){if(B.previousSibling){z.setEndBefore(B)}else{if(B.parentNode&&B.parentNode!==C){z.setEndBefore(B.parentNode)}}if(z.endContainer==B){break}}}catch(A){u(A,"fixSelection, while trying to set end")}try{while((B=z.startContainer)&&(B!==C)&&!z.collapsed){B=z.startContainer;if(B.nodeType==p.dom.TEXT_NODE){if(z.startOffset>=B.nodeValue.length){z.setStartAfter(B)}}else{if(z.startOffset>=B.childNodes.length){z.setStartAfter(B)}}if(z.startContainer==B){break}}}catch(A){u(A,"fixSelection, while trying to set start")}}function m(D,z,C){var B=D.length,A;if(z<0||z>=B){return D}if(z+C>=B){C=B-z}if(C===B){return D}A=z>0?D.splitText(z):D;if(A.length>C){A.splitText(C)}return A}function w(C,A,D,B){if(B){if(A.collapsed&&A.startContainer&&A.startContainer.nodeType===p.dom.TEXT_NODE&&A.startContainer.length){return}var z=D.createTextNode("\uFEFF");if(C){C.appendChild(z)}else{A.insertNode(z)}A.selectNode(z)}else{if(C){A.selectNodeContents(C)}}}function a(A,C){if(!A||!A.startContainer||!A.endContainer){return}var D=[];function z(G){if(!G){return""}G=G.replace("/\n/g","\\n").replace("/\r/g","").replace("\u200B","{filler}").replace("\uFEFF","{filler}");if(G.length<=15){return G}return G.substring(0,5)+"..."+G.substring(G.length-5)}function E(H){var I;if(H.nodeType===3){I="Text:"+z(H.nodeValue)}else{var G=H.innerText;I=H.nodeName+(G?"("+z(G)+")":"")}D.push("<"+I+" />")}function F(L,K,J){if("number"!==typeof J){J=-1}if(3==L.nodeType){var G=L.nodeValue;D.push(z(G.substring(0,K)));D.push("|");if(J>K){D.push(z(G.substring(K,J)));D.push("|");D.push(z(G.substring(J)))}else{D.push(z(G.substring(K)))}}else{if(1==L.nodeType){var I=0,H=L.childNodes,N=0;E(L);for(I=N;I<K;++I){E(H[I])}D.push("|");if(J>K){for(I=K;I<J;++I){E(H[I])}D.push("|")}if(J>0&&J<H.length){var M=H[J];while(M){E(M);M=M.nextSibling}}}}}if(A.startContainer===A.endContainer){F(A.startContainer,A.startOffset,A.endOffset)}else{F(A.startContainer,A.startOffset);F(A.endContainer,A.endOffset)}var B=D.join(" ");if(C){s.log(C+":"+B)}return B}p.printRange=a;p.InlineChangeEditor=g}(this.ice||window.ice,window.jQuery));(function(k,g){var e=k,c={},f=null,d=/^\s*$/,i=/^\d+$/;c.DOM_VK_DELETE=8;c.DOM_VK_LEFT=37;c.DOM_VK_UP=38;c.DOM_VK_RIGHT=39;c.DOM_VK_DOWN=40;c.DOM_VK_ENTER=13;c.ELEMENT_NODE=1;c.ATTRIBUTE_NODE=2;c.TEXT_NODE=3;c.CDATA_SECTION_NODE=4;c.ENTITY_REFERENCE_NODE=5;c.ENTITY_NODE=6;c.PROCESSING_INSTRUCTION_NODE=7;c.COMMENT_NODE=8;c.DOCUMENT_NODE=9;c.DOCUMENT_TYPE_NODE=10;c.DOCUMENT_FRAGMENT_NODE=11;c.NOTATION_NODE=12;c.CHARACTER_UNIT="character";c.WORD_UNIT="word";c.BREAK_ELEMENT="br";c.PARAGRAPH_ELEMENT="p";c.CONTENT_STUB_ELEMENTS=["img","hr","iframe","param","link","meta","input","frame","col","base","area"];c.BLOCK_ELEMENTS=["body","p","div","pre","ul","ol","li","table","tbody","td","th","fieldset","form","blockquote","dl","dt","dd","dir","center","address","h1","h2","h3","h4","h5","h6"];c.TEXT_CONTAINER_ELEMENTS=["body","p","div","pre","span","b","strong","i","li","td","th","blockquote","dt","dd","center","address","h1","h2","h3","h4","h5","h6","ins","del"];c.STUB_ELEMENTS=c.CONTENT_STUB_ELEMENTS.slice();c.STUB_ELEMENTS.push(c.BREAK_ELEMENT);var j=c.CONTENT_STUB_ELEMENTS.join(", ");c.isEmptyString=function(n){if(!n){return true}var l=n.length-1,m;while(l>=0){m=n[l--];if(m!=="\u200B"&&m!=="\uFEFF"){return false}}return true};c.getKeyChar=function(l){return String.fromCharCode(l.which)};c.getClass=function(n,m,l){if(!m){m=document.body}n="."+n.split(" ").join(".");if(l){n=l+n}return g.makeArray(g(m).find(n))};c.getId=function(m,l){if(!l){l=document}element=l.getElementById(m);return element};c.getTag=function(l,m){if(!m){m=document}return g.makeArray(g(m).find(l))};c.getElementWidth=function(l){return l.offsetWidth};c.getElementHeight=function(l){return l.offsetHeight};c.getElementDimensions=function(l){return{width:c.getElementWidth(l),height:c.getElementHeight(l)}};c.insertBefore=function(m,l){g(m).before(l)};c.insertAfter=function(o,n){if(o&&n){var m=o.nextSibling,l=o.parentNode;return m?l.insertBefore(n,m):l.appendChild(n)}};c.removeWhitespace=function(l){g(l).contents().filter(function(){if(this.nodeType!=k.dom.TEXT_NODE&&this.nodeName=="UL"||this.nodeName=="OL"){c.removeWhitespace(this);return false}else{if(this.nodeType!=k.dom.TEXT_NODE){return false}else{return !/\S/.test(this.nodeValue)}}}).remove()};c.contents=function(l){return g.makeArray(g(l).contents())};c.extractContent=function(l){var n=document.createDocumentFragment(),m;while((m=l.firstChild)){n.appendChild(m)}return n};c.getNode=function(m,l){if(!m){return null}m=m.$||m;return(m.nodeType!=c.TEXT_NODE&&g(m).is(l))?m:c.parents(m,l)[0]||null};c.getParents=function(r,o,q){var n=g(r).parents(o);var p=n.length;var l=[];for(var m=0;m<p;m++){if(n[m]===q){break}l.push(n[m])}return l};c.hasBlockChildren=function(m){var n=m.childNodes.length;for(var l=0;l<n;l++){if(m.childNodes[l].nodeType===c.ELEMENT_NODE){if(c.isBlockElement(m.childNodes[l])===true){return true}}}return false};c.removeTag=function(m,l){g(m).find(l).replaceWith(function(){return g(this).contents()});return m};c.stripEnclosingTags=function(l,n){var m=g(l);m.find("*").not(n).replaceWith(function(){var o=g();var q;try{q=g(this);o=q.contents()}catch(p){}if(o.length===0){q.remove()}return o});return m[0]};c.getSiblings=function(o,n,p,m){if(p===true){if(n==="prev"){return g(o).prevAll()}else{return g(o).nextAll()}}else{var l=[];if(n==="prev"){while(o.previousSibling){o=o.previousSibling;if(o===m){break}l.push(o)}}else{while(o.nextSibling){o=o.nextSibling;if(o===m){break}l.push(o)}}return l}};c.getNodeTextContent=function(l){return g(l).text()};c.getNodeStubContent=function(l){return g(l).find(j)};c.hasNoTextOrStubContent=function(l){var m=c.getNodeTextContent(l);if(!c.isEmptyString(m)){return false}if(!l.firstChild){return true}return g(l).find(j).length===0};c.isEmptyTextNode=function(l){if(!l||(c.TEXT_NODE!==l.nodeType)){return false}if(l.length===0){return true}return c.isEmptyString(l.nodeValue)};c.getNodeCharacterLength=function(l){return c.getNodeTextContent(l).length+g(l).find(c.STUB_ELEMENTS.join(", ")).length};c.setNodeTextContent=function(m,l){return g(m).text(l)};c.getTagName=function(l){return l&&l.tagName&&l.tagName.toLowerCase()||null};c.getIframeDocument=function(l){var m=null;if(l.contentDocument){m=l.contentDocument}else{if(l.contentWindow){m=l.contentWindow.document}else{if(l.document){m=l.document}}}return m};c.isBlockElement=function(l){return c.BLOCK_ELEMENTS.indexOf(l.nodeName.toLowerCase())!=-1};c.isStubElement=function(l){return c.STUB_ELEMENTS.indexOf(l.nodeName.toLowerCase())!=-1};c.removeBRFromChild=function(l){if(l&&l.hasChildNodes()){for(var m=0;m<l.childNodes.length;m++){var n=l.childNodes[m];if(n&&(k.dom.BREAK_ELEMENT==k.dom.getTagName(n))){n.parentNode.removeChild(n)}}}};c.isChildOf=function(m,l){try{while(m&&m.parentNode){if(m.parentNode===l){return true}m=m.parentNode}}catch(n){}return false};c.isChildOfTagName=function(m,l){try{while(m&&m.parentNode){if(m.parentNode&&m.parentNode.tagName&&m.parentNode.tagName.toLowerCase()===l){return m.parentNode}m=m.parentNode}}catch(n){}return false};c.isChildOfTagNames=function(m,o){try{while(m&&m.parentNode){if(m.parentNode&&m.parentNode.tagName){tagName=m.parentNode.tagName.toLowerCase();for(var l=0;l<o.length;l++){if(tagName===o[l]){return m.parentNode}}}m=m.parentNode}}catch(n){}return null};c.isChildOfClassName=function(m,l){try{while(m&&m.parentNode){if(g(m.parentNode).hasClass(l)){return m.parentNode}m=m.parentNode}}catch(n){}return null};c.replaceWith=function(m,l){return g(m).replaceWith(l)};c.getElementsBetween=function(u,q){var l=[];if(u===q){return l}if(c.isChildOf(q,u)===true){var r=u.childNodes.length;for(var o=0;o<r;o++){if(u.childNodes[o]===q){break}else{if(c.isChildOf(q,u.childNodes[o])===true){return c.arrayMerge(l,c.getElementsBetween(u.childNodes[o],q))}else{l.push(u.childNodes[o])}}}return l}var n=u.nextSibling;while(n){if(c.isChildOf(q,n)===true){l=c.arrayMerge(l,c.getElementsBetween(n,q));return l}else{if(n===q){return l}else{l.push(n);n=n.nextSibling}}}var w=c.getParents(u);var s=c.getParents(q);var v=c.arrayDiff(w,s,true);var t=v.length;for(var m=0;m<(t-1);m++){l=c.arrayMerge(l,c.getSiblings(v[m],"next"))}var p=v[(v.length-1)];l=c.arrayMerge(l,c.getElementsBetween(p,q));return l};c.getCommonAncestor=function(m,l){var n=m;while(n){if(c.isChildOf(l,n)===true){return n}n=n.parentNode}return null};c.getNextNode=function(m,l){if(m){while(m.parentNode){if(m===l){return null}if(m.nextSibling){if(m.nextSibling.nodeType===c.TEXT_NODE&&m.nextSibling.length===0){m=m.nextSibling;continue}return c.getFirstChild(m.nextSibling)}m=m.parentNode}}return null};c.getNextContentNode=function(m,l){if(m){while(m.parentNode){if(m===l){return null}if(m.nextSibling&&c.canContainTextElement(c.getBlockParent(m))){if(m.nextSibling.nodeType===c.TEXT_NODE&&m.nextSibling.length===0){m=m.nextSibling;continue}return m.nextSibling}else{if(m.nextElementSibling){return m.nextElementSibling}}m=m.parentNode}}return null};c.getPrevNode=function(m,l){if(m){while(m.parentNode){if(m===l){return null}if(m.previousSibling){if(m.previousSibling.nodeType===c.TEXT_NODE&&m.previousSibling.length===0){m=m.previousSibling;continue}return c.getLastChild(m.previousSibling)}m=m.parentNode}}return null};c.getPrevContentNode=function(m,l){if(m){while(m.parentNode){if(m===l){return null}if(m.previousSibling&&c.canContainTextElement(c.getBlockParent(m))){if(m.previousSibling.nodeType===c.TEXT_NODE&&m.previousSibling.length===0){m=m.previousSibling;continue}return m.previousSibling}else{if(m.previousElementSibling){return m.previousElementSibling}}m=m.parentNode}}return null};function h(n,l){while(n){if(c.TEXT_NODE==n.nodeType){return n}for(var o=n.firstChild;o;o=o.nextSibling){var m=h(o,l);if(m){return m}}if(c.isTextContainer(n)){return n}n=n.nextSibling}return null}function a(n,l){while(n){if(c.TEXT_NODE==n.nodeType){return n}for(var o=n.lastChild;o;o=o.previousSibling){var m=a(o,l);if(m){return m}}if(c.isTextContainer(n)){return n}n=n.previousSibling}return null}c.findPrevTextContainer=function(n,l){if(!n||n==l){return{node:l,offset:0}}if(n.parentNode&&c.isTextContainer(n.parentNode)){return{node:n.parentNode,offset:c.getNodeIndex(n)}}while(n.previousSibling){var m=a(n.previousSibling);if(m){return{node:m,offset:c.getNodeLength(m)}}n=n.previousSibling}return c.findPrevTextContainer(n.parentNode&&n.parentNode.previousSibling,l)};c.findNextTextContainer=function(n,l){if(!n||n==l){return{node:l,offset:c.getNodeLength(l)}}if(n.parentNode&&c.isTextContainer(n.parentNode)){return{node:n.parentNode,offset:c.getNodeIndex(n)+1}}while(n.nextSibling){var m=h(n.nextSibling);if(m){return{node:m,offset:0}}n=n.previousSibling}return c.findNextTextContainer(n.parentNode&&n.parentNode.nextSibling,l)};c.getNodeLength=function(l){return l?(c.TEXT_NODE==l.nodeType?l.length:((l.childNodes&&l.childNodes.length)||0)):0};c.isTextContainer=function(l){return(l&&(c.TEXT_NODE==l.nodeType)||c.TEXT_CONTAINER_ELEMENTS.indexOf((l.nodeName||"").toLowerCase())>=0)};c.getNodeIndex=function(m){var l=0;while((m=m.previousSibling)){++l}return l};c.canContainTextElement=function(l){if(l&&l.nodeName){return c.TEXT_CONTAINER_ELEMENTS.lastIndexOf(l.nodeName.toLowerCase())!=-1}else{return false}};c.getFirstChild=function(l){if(l.firstChild){if(l.firstChild.nodeType===c.ELEMENT_NODE){return c.getFirstChild(l.firstChild)}else{return l.firstChild}}return l};c.getLastChild=function(l){if(l.lastChild){if(l.lastChild.nodeType===c.ELEMENT_NODE){return c.getLastChild(l.lastChild)}else{return l.lastChild}}return l};c.removeEmptyNodes=function(n,o){var l=g(n).find(":empty");var m=l.length;while(m>0){m--;if(c.isStubElement(l[m])===false){if(!o||o.call(this,l[m])!==false){c.remove(l[m])}}}};c.create=function(l){return g(l)[0]};c.children=function(l,m){return g(l).children(m)};c.parent=function(m,l){return g(m).parent(l)[0]};c.parents=function(m,l){return g(m).parents(l)};c.walk=function(m,o,l){if(!m){return}if(!l){l=0}var n=o.call(this,m,l);if(n===false){return}if(m.childNodes&&m.childNodes.length>0){c.walk(m.firstChild,o,(l+1))}else{if(m.nextSibling){c.walk(m.nextSibling,o,l)}else{if(m.parentNode&&m.parentNode.nextSibling){c.walk(m.parentNode.nextSibling,o,(l-1))}}}};c.revWalk=function(l,n){if(!l){return}var m=n.call(this,l);if(m===false){return}if(l.childNodes&&l.childNodes.length>0){c.walk(l.lastChild,n)}else{if(l.previousSibling){c.walk(l.previousSibling,n)}else{if(l.parentNode&&l.parentNode.previousSibling){c.walk(l.parentNode.previousSibling,n)}}}};c.setStyle=function(l,n,m){if(l){g(l).css(n,m)}};c.getStyle=function(l,m){return g(l).css(m)};c.hasClass=function(l,m){return g(l).hasClass(m)};c.addClass=function(l,m){g(l).addClass(m)};c.removeClass=function(l,m){g(l).removeClass(m)};c.preventDefault=function(l){l.preventDefault();c.stopPropagation(l)};c.stopPropagation=function(l){l.stopPropagation()};c.isBlank=function(l){return(!l||d.test(l))};c.isFn=function(l){return(typeof l==="function")};c.isObj=function(l){return(l!==null&&typeof l==="object")};c.isset=function(l){return(typeof l!=="undefined"&&l!==null)};c.isArray=function(l){return g.isArray(l)};c.isNumeric=function(l){return l.match(i)!==null};c.getUniqueId=function(){var m=(new Date()).getTime();var l=Math.ceil(Math.random()*1000000);var n=m+""+l;return n.substr(5,18).replace(/,/,"")};c.inArray=function(o,m){var n=m.length;for(var l=0;l<n;l++){if(o===m[l]){return true}}return false};c.arrayDiff=function(p,o,n){var q=p.length,m,l=[];for(m=0;m<q;m++){if(c.inArray(p[m],o)===false){l.push(p[m])}}if(n!==true){q=o.length;for(m=0;m<q;m++){if(c.inArray(o[m],p)===false){l.push(o[m])}}}return l};c.arrayMerge=function(n,m){var o=m.length,l;for(l=0;l<o;l++){n.push(m[l])}return n};c.stripTags=function(n,q){if(typeof q==="string"){var p=g("<div>"+n+"</div>");p.find("*").not(q).remove();return p.html()}else{var l;var m=new RegExp(/<\/?(\w+)((\s+\w+(\s*=\s*(?:".*?"|'.*?'|[^'">\s]+))?)+\s*|\s*)\/?>/gim);var o=n;while((l=m.exec(n))!=null){if(c.isset(q)===false||c.inArray(l[1],q)!==true){o=o.replace(l[0],"")}}return o}};c.browser=function(){if(f){return g.extend({},f)}f=(function(){function m(q){q=q.toLowerCase();var p=/(chrome)[ \/]([\w.]+)/.exec(q)||/(webkit)[ \/]([\w.]+)/.exec(q)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(q)||/(msie) ([\w.]+)/.exec(q)||q.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(q)||[];return{browser:p[1]||"",version:p[2]||"0"}}var o=navigator.userAgent.toLowerCase(),l=m(o),n={type:"unknown",version:0,msie:false};if(l.browser){n[l.browser]=true;n.version=l.version||0;n.type=l.browser}if(n.chrome){n.webkit=true}else{if(n.webkit){n.safari=true}}if(n.webkit){n.type="webkit"}n.firefox=(/firefox/.test(o)==true);if(!n.msie){n.msie=Boolean(/trident/.test(o))}return n})();return g.extend({},f)};c.getBrowserType=function(){if(this._browserType===null){var n=["msie","firefox","chrome","safari"];var m=n.length;for(var l=0;l<m;l++){var o=new RegExp(n[l],"i");if(o.test(navigator.userAgent)===true){this._browserType=n[l];return this._browserType}}this._browserType="other"}return this._browserType};c.getWebkitType=function(){if(c.browser().type!=="webkit"){console.log("Not a webkit!");return false}var l=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;if(l){return"safari"}return"chrome"};c.isBrowser=function(l){return(c.browser().type===l)};c.getBlockParent=function(m,l){if(c.isBlockElement(m)===true){return m}if(m){while(m.parentNode){m=m.parentNode;if(c.isBlockElement(m)===true){return m}if(m===l){return null}}}return null};c.findNodeParent=function(n,l,m){if(n){while(n.parentNode){if(n===m){return null}if(g(n).is(l)===true){return n}n=n.parentNode}}return null};c.onBlockBoundary=function(p,n,o){if(!p||!n){return false}var m=o.join(", "),l=c.isChildOfTagNames(p,o)||g(p).is(m)&&p||null,q=c.isChildOfTagNames(n,o)||g(n).is(m)&&n||null;return(l!==q)};c.isOnBlockBoundary=function(o,n,l){if(!o||!n){return false}var m=c.getBlockParent(o,l)||c.isBlockElement(o,l)&&o||null,p=c.getBlockParent(n,l)||c.isBlockElement(n,l)&&n||null;return(m!==p)};c.mergeContainers=function(m,l){if(!m||!l){return false}if(m.nodeType===c.TEXT_NODE||c.isStubElement(m)){l.appendChild(m)}else{if(m.nodeType===c.ELEMENT_NODE){while(m.firstChild){l.appendChild(m.firstChild)}g(m).remove()}}return true};c.mergeBlockWithSibling=function(l,o,n){var m=n?g(o).next().get(0):g(o).prev().get(0);if(n){c.mergeContainers(m,o)}else{c.mergeContainers(o,m)}l.collapse(true);return true};c.date=function(w,t,m){if(t===null&&m){t=c.tsIso8601ToTimestamp(m);if(!t){return}}var o=new Date(t);var v=w.split("");var n=v.length;var p="";for(var q=0;q<n;q++){var l="";var s=v[q];switch(s){case"D":case"l":var u=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];l=u[o.getDay()];if(s==="D"){l=l.substring(0,3)}break;case"F":case"m":l=o.getMonth()+1;if(l<10){l="0"+l}break;case"M":months=["January","February","March","April","May","June","July","August","September","October","November","December"];l=months[o.getMonth()];if(s==="M"){l=l.substring(0,3)}break;case"d":l=o.getDate();break;case"S":l=c.getOrdinalSuffix(o.getDate());break;case"Y":l=o.getFullYear();break;case"y":l=o.getFullYear();l=l.toString().substring(2);break;case"H":l=o.getHours();break;case"h":l=o.getHours();if(l===0){l=12}else{if(l>12){l-=12}}break;case"i":l=c.addNumberPadding(o.getMinutes());break;case"a":l="am";if(o.getHours()>=12){l="pm"}break;default:l=s;break}p+=l}return p};c.getOrdinalSuffix=function(m){var n="";var l=(m%100);if(l>=4&&l<=20){n="th"}else{switch(m%10){case 1:n="st";break;case 2:n="nd";break;case 3:n="rd";break;default:n="th";break}}return n};c.addNumberPadding=function(l){if(l<10){l="0"+l}return l};c.tsIso8601ToTimestamp=function(l){var n=/(\d\d\d\d)(?:-?(\d\d)(?:-?(\d\d)(?:[T ](\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(?:Z|(?:([-+])(\d\d)(?::?(\d\d))?)?)?)?)?)?/;var p=l.match(new RegExp(n));if(p){var m=new Date();m.setDate(p[3]);m.setFullYear(p[1]);m.setMonth(p[2]-1);m.setHours(p[4]);m.setMinutes(p[5]);m.setSeconds(p[6]);var o=(p[9]*60);if(p[8]==="+"){o*=-1}o-=m.getTimezoneOffset();return(m.getTime()+(o*60*1000))}return null};c.normalizeNode=function(m,l){if(!m){return}if(!c.browser().msie&&(l!==true&&"function"==typeof m.normalize)){return m.normalize()}return b(m)};function b(o){if(!o){return}var l=1;var m=3;var q=o.firstChild;while(q){if(q.nodeType==l){b(q)}else{if(q.nodeType==m){var n;while((n=q.nextSibling)&&n.nodeType==m){var p=n.nodeValue;if(p!=null&&p.length){q.nodeValue=q.nodeValue+p}o.removeChild(n)}}}q=q.nextSibling}}e.dom=c}(this.ice||window.ice,window.jQuery));(function(d){var a=d,b=d.rangy,c;c=function(e){this._selection=null;this.env=e;this._initializeRangeLibrary();this._getSelection()};c.prototype={_getSelection:function(){if(this._selection){this._selection.refresh()}else{if(this.env.frame){this._selection=b.getSelection(this.env.frame)}else{this._selection=b.getSelection()}}return this._selection},createRange:function(){return b.createRange(this.env.document)},getRangeAt:function(h){try{this._selection.refresh();return this._selection.getRangeAt(h)}catch(f){this._selection=null;try{return this._getSelection().getRangeAt(0)}catch(g){}}return null},addRange:function(e){this._selection||(this._selection=this._getSelection());this._selection.setSingleRange(e);this._selection.ranges=[e]},_initializeRangeLibrary:function(){var f=this;b.init();b.config.checkSelectionRanges=false;var e=function(i,j,h,g){if(h===0){return}var k=i.collapsed;switch(j){case ice.dom.CHARACTER_UNIT:if(h>0){i.moveCharRight(g,h)}else{i.moveCharLeft(g,h*-1)}break;case ice.dom.WORD_UNIT:default:break}if(k){i.collapse(g)}};b.rangePrototype.moveStart=function(h,g){e(this,h,g,true)};b.rangePrototype.moveEnd=function(h,g){e(this,h,g,false)};b.rangePrototype.setRange=function(i,g,h){if(i){this.setStart(g,h)}else{this.setEnd(g,h)}};b.rangePrototype.moveCharLeft=function(j,i){var h,l;if(j){h=this.startContainer;l=this.startOffset}else{h=this.endContainer;l=this.endOffset}if(h.nodeType===ice.dom.ELEMENT_NODE){if(h.hasChildNodes()&&l>0){var k=h.childNodes[l-1],g=this.getLastSelectableChild(k);if(g){h=g}else{h=this.getPreviousTextNode(k)}if(!h){return}l=h.data.length-i}else{l=i*-1}}else{l-=i}if(l<0){while(l<0){h=this.getPreviousTextNode(h);if(!h){return}if(h.nodeType===ice.dom.ELEMENT_NODE){continue}l+=h.data.length}}this.setRange(j,h,l)};b.rangePrototype.moveCharRight=function(i,h){var g,l;if(i){g=this.startContainer;l=this.startOffset}else{g=this.endContainer;l=this.endOffset}if(g.nodeType===ice.dom.ELEMENT_NODE){var j=this.getNextTextNode(g.childNodes[Math.min(l,g.childNodes.length-1)]);if(j){g=j}else{g=this.getNextTextNode(g)}l=h}else{l+=h}if(!g){return}var k=(l-g.data.length);if(k>0){while(k>0){g=this.getNextContainer(g);if(!g){return}if(g.nodeType===ice.dom.ELEMENT_NODE){continue}if(g.data.length>=k){break}else{if(g.data.length>0){k-=g.data.length}}}l=k}this.setRange(i,g,l)};b.rangePrototype.getNextContainer=function(g,j){if(!g){return null}j=j||[];while(g.nextSibling){g=g.nextSibling;if(g.nodeType!==ice.dom.TEXT_NODE){var i=this.getFirstSelectableChild(g);if(i!==null){return i}}else{if(this.isSelectable(g)===true){return g}}}while(g&&!g.nextSibling){g=g.parentNode}if(!g){return null}g=g.nextSibling;if(this.isSelectable(g)===true){return g}else{if(ice.dom.isBlockElement(g)===true){j.push(g)}}var h=this.getFirstSelectableChild(g);if(h!==null){return h}return this.getNextContainer(g,j)};b.rangePrototype.getPreviousContainer=function(g,j){if(!g){return null}j=j||[];while(g.previousSibling){g=g.previousSibling;if(g.nodeType!==ice.dom.TEXT_NODE){if(ice.dom.isStubElement(g)===true){return g}else{var i=this.getLastSelectableChild(g);if(i!==null){return i}}}else{if(this.isSelectable(g)===true){return g}}}while(g&&!g.previousSibling){g=g.parentNode}if(!g){return null}g=g.previousSibling;if(this.isSelectable(g)===true){return g}else{if(ice.dom.isBlockElement(g)===true){j.push(g)}}var h=this.getLastSelectableChild(g);if(h!==null){return h}return this.getPreviousContainer(g,j)};b.rangePrototype.getNextTextNode=function(g){if(g.nodeType===ice.dom.ELEMENT_NODE){if(g.firstChild){var h=this.getFirstSelectableChild(g);if(h){return h}}}g=this.getNextContainer(g);if(!g){return null}if(g.nodeType===ice.dom.TEXT_NODE){return g}return this.getNextTextNode(g)};b.rangePrototype.getPreviousTextNode=function(g,h){g=this.getPreviousContainer(g,h);if(!g){return null}if(g.nodeType===ice.dom.TEXT_NODE){return g}return this.getPreviousTextNode(g,h)};b.rangePrototype.getFirstSelectableChild=function(h){if(!h){return null}if(h.nodeType===ice.dom.TEXT_NODE){return h}var i=h.firstChild;while(i){if(this.isSelectable(i)===true){return i}else{if(i.firstChild){var g=this.getFirstSelectableChild(i);if(g!==null){return g}else{i=i.nextSibling}}else{i=i.nextSibling}}}return null};b.rangePrototype.getLastSelectableChild=function(h){if(!h){return null}if(h.nodeType==ice.dom.TEXT_NODE){return h}var i=h.lastChild;while(i){if(this.isSelectable(i)===true){return i}else{if(i.lastChild){var g=this.getLastSelectableChild(i);if(g!==null){return g}else{i=i.previousSibling}}else{i=i.previousSibling}}}return null};b.rangePrototype.isSelectable=function(g){return Boolean(g&&g.nodeType===ice.dom.TEXT_NODE&&g.data.length!==0)};b.rangePrototype.getHTMLContents=function(g){if(!g){g=this.cloneContents()}var h=f.env.document.createElement("div");h.appendChild(g.cloneNode(true));return h.innerHTML};b.rangePrototype.getHTMLContentsObj=function(){return this.cloneContents()}}};a.Selection=c}(this.ice||window.ice));(function(c,d){var a=c,b;b=function(j,h,o){this.env=j;this.element=j.element;this.selection=this.env.selection;if(!o){this.removeBookmarks(this.element)}var n=h||this.selection.getRangeAt(0),h=n.cloneRange(),f=h.startContainer,m=h.startOffset,g;h.collapse(false);var k=this.env.document.createElement("span");k.style.display="none";d(k).html("&nbsp;").addClass("iceBookmark iceBookmark_end").attr("iceBookmark","end");h.insertNode(k);if(!c.dom.isChildOf(k,this.element)){this.element.appendChild(k)}h.setStart(f,m);h.collapse(true);var i=this.env.document.createElement("span");i.style.display="none";d(i).addClass("iceBookmark iceBookmark_start").html("&nbsp;").attr("iceBookmark","start");try{h.insertNode(i);if(i.previousSibling===k){g=i;i=k;k=g}}catch(l){c.dom.insertBefore(k,i)}if(c.dom.isChildOf(i,this.element)===false){if(this.element.firstChild){c.dom.insertBefore(this.element.firstChild,i)}else{this.element.appendChild(i)}}if(!k.previousSibling){g=this.env.document.createTextNode("");c.dom.insertBefore(k,g)}if(!i.nextSibling){g=this.env.document.createTextNode("");c.dom.insertAfter(i,g)}n.setStart(i.nextSibling,0);n.setEnd(k.previousSibling,(k.previousSibling.length||0));this.start=i;this.end=k};b.prototype={selectStartAndCollapse:function(){if(this.start){var f=this.selection.getRangeAt(0);f.setStartBefore(this.start);f.collapse(true);d([this.start,this.end]).remove();try{this.selection.addRange(f)}catch(g){}}},remove:function(){if(this.start){d([this.start,this.end]).remove();this.start=this.end=null}},selectBookmark:function(){var g=this.selection.getRangeAt(0),j=null,i=null,f=0,h=null,l=this.start&&this.start.parentNode;if(this.start.nextSibling===this.end||c.dom.getElementsBetween(this.start,this.end).length===0){if(this.end.nextSibling){j=c.dom.getFirstChild(this.end.nextSibling)}else{if(this.start.previousSibling){j=c.dom.getFirstChild(this.start.previousSibling);if(j.nodeType===c.dom.TEXT_NODE){f=j.length}}else{this.end.parentNode.appendChild(this.env.document.createTextNode(""));j=c.dom.getFirstChild(this.end.nextSibling)}}}else{if(this.start.nextSibling){j=c.dom.getFirstChild(this.start.nextSibling)}else{if(!this.start.previousSibling){var k=this.env.document.createTextNode("");c.dom.insertBefore(this.start,k)}j=c.dom.getLastChild(this.start.previousSibling);f=j.length}if(this.end.previousSibling){i=c.dom.getLastChild(this.end.previousSibling)}else{i=c.dom.getFirstChild(this.end.nextSibling||this.end);h=0}}d([this.start,this.end]).remove();try{c.dom.normalize(l)}catch(m){}if(i===null){if(g){g.setEnd(j,f);g.collapse(false)}}else{g.setStart(j,f);if(h===null){h=(i.length||0)}g.setEnd(i,h)}try{this.selection.addRange(g)}catch(m){}},getBookmark:function(f,e){var g=c.dom.getClass("iceBookmark_"+e,f)[0];return g},removeBookmarks:function(e){d(e).find("span.iceBookmark").remove()}};a.Bookmark=b}(this.ice||window.ice,window.jQuery));var LITE={Events:{INIT:"lite:init",ACCEPT:"lite:accept",REJECT:"lite:reject",SHOW_HIDE:"lite:showHide",TRACKING:"lite:tracking",CHANGE:"lite:change",HOVER_IN:"lite:hover-in",HOVER_OUT:"lite:hover-out"},Commands:{TOGGLE_TRACKING:"lite-toggletracking",TOGGLE_SHOW:"lite-toggleshow",ACCEPT_ALL:"lite-acceptall",REJECT_ALL:"lite-rejectall",ACCEPT_ONE:"lite-acceptone",REJECT_ONE:"lite-rejectone",TOGGLE_TOOLTIPS:"lite-toggletooltips"}};
/* Copyright (C) 2015 LoopIndex - All Rights Reserved
 * You may use, distribute and modify this code under the
 * terms of the LoopIndex Comments CKEditor plugin license.
 *
 * You should have received a copy of the LoopIndex Comments CKEditor plugin license with
 * this file. If not, please write to: loopindex@gmail.com, or visit http://www.loopindex.com
 * written by (David *)Frenkiel (https://github.com/imdfl) 
 */